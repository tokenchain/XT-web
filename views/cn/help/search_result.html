<link rel="stylesheet" href="<%= STYLE_STATIC %>/styles/help/search_result.css?<%= VERSION %>">

<section class="search_section" >
    <%-include("help_search.html")%>
    <div id="search_result" class="search_result">
        <div class="witdh-1095">
            <div class="search-title"v-cloak>
                <h2><%= LANG('搜索') %>"{{searchText}}"<%= LANG('的结果') %></h2>
                <a class="return-help" href="/help"><%= LANG('返回帮助中心') %></a>
            </div>

            <ul class="search-ul">
                <li class="search-item" v-for="(item,key) in searchResult">
                    <h3 class="item-title" v-html="item.articleTitle" @click="changeArticle(item)"></h3>
                    <!--内容处理-->
                    <div class="item-content" v-html="item.contentStr"></div>
                </li>
            </ul>
        </div>
    </div>
</section>

<script>
    require(['vue', 'common/methods'], function (Vue, Methods) {
        new Vue({
            el: '#search_result',
            created: function () {
                var param = Methods.parseQueryString()
                if (param.contentPart) {
                    this.searchText = decodeURI(param.contentPart)
                }
                this.getFaqArticles(this.searchText)
            },
            data: function () {
                return {
                    searchText: '',
                    searchResult: []
                }
            },
            methods: {
                getFaqArticles: function (searchText) {
                    var that = this
                    if (searchText != '') {
                        var lanNum = 1
                        switch (LAN) {
                            case "cn":
                                lanNum = 1
                                break;
                            case "en":
                                lanNum = 2
                                break;
                            case "kr":
                                lanNum = 3
                                break;
                            case "jp":
                                lanNum = 4
                                break;
                        }
                        var data = {
                            contentPart: decodeURI(searchText),
                            lanType: lanNum
                        };

                        Methods.ajax({
                            type: 'GET',
                            url: DOMAIN_DEV + "/exchange/support/controller/website/articlecontroller/" + 'search',
                            data: data,
                            success: function (res) {
                                var searchResult = res.datas
                                if (searchResult.length > 0) {
                                    var replaceText = that.searchText
                                    var regExp = new RegExp(replaceText, "g")
                                    for (var i = 0; i < searchResult.length; i++) {
                                        searchResult[i].contentStr = searchResult[i].contentStr.replace(regExp, '<em class="high-light">' + replaceText + '</em>')
                                        searchResult[i].articleTitle = searchResult[i].articleTitle.replace(regExp, '<em class="high-light">' + replaceText + '</em>')
                                    }
                                    that.searchResult = res.datas
                                }
                            }
                        });
                    }
                },
                changeArticle: function (item) {
                    window.location.replace('/help/articles?categoryId=' + item.categoryId + '&articleId=' + item.articleId);
                }
            }
        })
    })
</script>