<style>
    /*
    #user-nav {display: none}
    */
    .panel-content{padding: 0 !important; margin: 0 !important; height: 100vh;}
    .panel-content *{padding: 0; margin: 0;line-height: 1;}
    .capital_Import_wrapper {
        display: table;
        width: 100%;
        height: 100%;
    }
    .capital_Import_wrapper_inner {
        display: table-cell;
        vertical-align: middle;
        padding: 100px 0;
    }

    .capital_Import{
        width: 650px;
        margin: auto;
        padding: 50px 0 40px 0;
        background: #fff;
        border-radius: 5px;
        box-shadow: 1px 1px 5px rgba(0,0,0,.1);
        position: relative;
    }

    .capital_Import h3{font-size: 22px; font-weight: bold; text-align: center; color: #000;}
    .capital_Import .tips{font-size: 12px; font-weight: bold; color: #666;text-align: center; margin: 20px 0;}

    .capital_Import .coinlist{overflow: hidden; border-top: 1px solid #eaeaea;border-bottom: 1px solid #eaeaea;}
    .capital_Import .coinlist .item{padding: 15px 64px;font-family: Arial;border-bottom: 1px dotted #eaeaea;
        display: flex;flex-flow:row nowrap;justify-content:space-between;align-items:center;
    }
    .capital_Import .coinlist .item:last-child{border-bottom: none;}
    .capital_Import .coinlist .item h4{font-size: 16px; color: #000; font-weight: bold; position: relative; padding-left: 30px;}
    .capital_Import .coinlist .item h4 img{width: 22px; position: absolute; left: 0;top:-4px;}
    .capital_Import .coinlist .item p{font-size: 14px; color: #888; font-weight: bold;}

    .capital_Import .password{text-align: center;padding: 40px 0;}
    .capital_Import .password > p{color: #666;font-weight: bold; margin-bottom: 15px;}
    .capital_Import .password input{height: 40px; width: 400px; background: #fff; border-radius: 3px; padding: 15px; color: #888; text-align: center;font-size: 20px;border: 2px solid #ebedef;}
    .capital_Import .password input:focus{border-color:#fba81c;}
    .capital_Import .password input:-webkit-autofill{-webkit-box-shadow: 0 0 0 1000px #fff inset !important; -webkit-text-fill-color: #555;}

    .capital_Import .password .agreement{margin-top: 20px;}
    .capital_Import .password .agreement a{font-size: 12px; text-decoration: none;}
    .capital_Import_button {text-align: center;}
    .capital_Import_button .exxbtn{margin: 0 5px;width: 150px;}

    .agreement_a{display: inline-block;position: relative;z-index: 102;background: #fff;padding: 5px 0; border-radius: 2px;}
    .agreement_box{background: #fff;padding:40px;border-radius: 2px; box-shadow: 0 0 5px rgba(0,0,0,.2); z-index: 101; position: absolute; bottom: 160px; right: 0; left: 0;}
    .agreement_box:after{content: "";display: block; position: absolute; bottom: -5px; right: 265px; height: 0; width: 0; border-top: 5px solid #fff;border-left: 5px solid transparent;border-right: 5px solid transparent;}
    .agreement_box h5{text-align:center;font-size: 20px; color: #000; font-weight: bold;margin-bottom: 30px;}
    .agreement_box p.title{color: #555;font-size:14px;font-weight: bold;line-height: 22px;}
    .agreement_box .info{text-align: left;font-size: 14px; color: #888; }
    .agreement_box .info p{margin-top: 20px;line-height: 24px;}
    h3 .desc {font-size: 12px; color: #F00; font-weight: normal; padding-top: 20px;}

    @media (max-width:767px) {
        .s-user .panel-content {
            overflow: auto;
        }
        .capital_Import h3 {
            padding: 0 15px;
        }
        .capital_Import{
            width: 90%;

            margin: 0 auto;
        }
        .capital_Import .password input {
            width: 300px;
        }
    }

</style>
<script type="text/javascript" src="<%= STATIC %>/scripts/xulei-v1.js"></script>
<div class="capital_Import_wrapper">
    <div class="capital_Import_wrapper_inner">
<div id="transfer-asset" class="capital_Import">
        <h3>
            <%= LANG('检测到您是EXX商务合作方会员,您的可用资产可以一键转入') %>
            <p class="desc"><%= LANG('如果您在合作方有未完成的提现，建议取消后再重新登录进行本操作，本操作仅可执行一次!') %></p>
        </h3>

            <p class="tips"><%= LANG('您的可用资产情况如下') %></p>



    <div class="coinlist" v-cloak>
        <template v-for="(asset, coin) in assets.coinFundsMap">
            <div class="item" v-if="isDisplay(coin)">
                <h4><img :src="'<%= STATIC %>/images/icon/market-icon/market-' + coin + '.png'">{{coin}}</h4>
                <p>{{asset.available}}</p>
            </div>
        </template>
    </div>

    <div class="password">
        <p><%= LANG('请输入您的资金密码') %></p>
        <input autocomplete="new-password" v-model="safePwd" type="password">
        <div class="agreement">
            <div class="exx-checkbox"><label><input type="checkbox" v-model="agree"><i></i></label><p @mouseover="showAgreement = true" @mouseleave="showAgreement = false" class="agreement_a"><%= LANG('我已阅读并同意') %><a href="#"><%= LANG('《转移协议》') %></a></p></div>

        </div>


        </div>


    <div class="capital_Import_button">
        <button @click="handleSkip" class="exxbtn btn-cancel"><span><%= LANG('下次再说') %></span></button>
        <button type="submit" @click="handleSubmit('1')" class="exxbtn btn-ok"><span><%= LANG('确定转移') %></span></button>
    </div>
    <p class="exx-txtcenter exx-mt20"><a  @click="handleSubmit('0')" style="font-size: 14px; color: #ddd;" href="#"><%= LANG('不再提示') %></a></p>
    <div class="agreement_box" v-if="showAgreement" v-cloak>
        <h5><%= LANG('关于商业合作用户资产转移协议') %></h5>
        <p class="title"><%= LANG('现就EXX用户（转入账号）对存在于EXX的商业合作方上的指定账号（转出账号）可用资产转移达成如下协议') %>：</p>
        <div class="info">
            <p><%= LANG('一、用户对转出账号的资产系该用户拥有占有和使用权的个人合法资产；') %></p>
            <p><%= LANG('二、用户自愿将转出账号的资产及相关信息转移至转入账号；') %></p>
            <p><%= LANG('三、EXX保证用户资产转移的过程安全、有效；') %></p>
            <p><%= LANG('四、用户转移资产时，需要验证转出账号的资金密码，用户提交验证通过则代表用户授权EXX平台将转出账号的资产转移到转入账号的操作；') %></p>
            <p><%= LANG('五、用户确认了解并清楚转移的过程，转出资产后，转移列表中列出的资产将从转出账号减少，并在转入账号增加对应的数量。') %></p>
        </div>
    </div>
    <div  v-cloak class="agreement_model" style="position: fixed; left: 0; top:0; right: 0; bottom: 0; background: rgba(0,0,0,.5); z-index: 100;"  v-if="showAgreement"></div>
</div>

    </div>
</div>

<script>

    require(['vue', 'common/methods', 'common/juabox'], function(Vue, Methods, JuaBox ) {
        var transferAsset = new Vue({
            el: '#transfer-asset',
            data: function() {
                return {
                    pubKey: '',
                    showAgreement: false,
                    agree: false,
                    assets: {},
                    loginUser: Methods.getLocalUserInfo(),
                    safePwd: ''
                }
            },
            methods: {
                isDisplay: function(coin) {
                    var res = true;
                    if (coin === 'cny' || coin == 'btq') {
                        res = false;
                    }
                    return res;
                },
                handleSkip: function() {
                  window.location.href = DOMAIN_WEB + '/u';
                },
                // getPubKey: function() {
                //     Methods.ajax({
                //         type: 'GET',
                //         url: DOMAIN_DEV + "/exchange/controller/website/common/baseapicontroller/" + 'getpubkey',
                //         success: function (res) {
                //             this.pubKey = res.datas.pubKey;
                //         }.bind(this)
                //     });
                // },
                getPartnerAssets: function() {
                    var data = {
                    };
                    Methods.ajax({
                        type: "POST",
                        url: DOMAIN_MAIN + API_PREFIX + 'getBusiAssets',
                        data: data,
                        success: function (res) {
                            this.assets = res.datas.assets;
                        }.bind(this)
                    });
                },
                handleSubmit: function(type) {
                    var data = {
                        type: type,
                        safePwd: Methods.encryptPwd(this.safePwd, this.pubKey)
                    };
                    if (type == '1' && this.safePwd == '') {
                        JuaBox.info("<%= LANG('请输入您的资金密码') %>");
                        return;
                    } else if (type == '1' && !this.agree) {
                        JuaBox.info("<%= LANG('请阅读并同意《转移协议》') %>");
                        return;
                    }
                    Methods.ajax({
                        type: "POST",
                        url: DOMAIN_MAIN + API_PREFIX + 'transferAsset',
                        data: data,
                        success: function (res) {
                            //Methods.setLocalUserInfo(res.datas.userInfo);
                            swal({
                                title: "<%= LANG('提交成功') %>",
                                text: "<%= LANG('系统已受理您的请求，预计十分钟后到账，期间您也可以进行其它操作。') %>",
                                icon: "success",
                                buttons: ["<%= LANG('确定') %>!", false],
                                dangerMode: false
                            }).then(function(){
                                window.location.replace('/u');
                            });
                            //window.location.replace('/u');
                        }
                    });
                }
            },
            created: function() {
                // this.getPubKey();
                this.getPartnerAssets()
            }
        })
    });
</script>

