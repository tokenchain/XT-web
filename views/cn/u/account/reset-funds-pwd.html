<link href="<%= STATIC %>/styles/u/account/reset-funds-pwd.css?<%= VERSION %>" rel="stylesheet" type="text/css">

<div id="reset-funds-pwd" class="reset-funds-pwd">
    <div class="container">
        <div class="container-top">
            <h1 class="top-title"><%= LANG('重置资金密码')%></h1>
        </div>
        <div class="pwd-course-box flex-double-center" v-if="resetType != -1" v-cloak="">
            <ul class="pwd-course">
                <li class="pwd-course-li flex-double-center">
                    <div class="course-round flex-double-center">1
                        <div class="round-title"><%= LANG('重置资金密码')%></div>
                    </div>
                    <span class="course-line"></span>
                </li>
                <li class="pwd-course-li flex-double-center">
                    <span class="course-line"></span>
                    <div class="course-round flex-double-center" :class="{'course-round-none':course == 1}">2
                        <div class="round-title"><%= LANG('重置成功')%></div>
                    </div>
                </li>
            </ul>
        </div>

        <div class="pwd-type-box" v-if="resetType == -1">
            <ul class="pwd-type flex-double-center">
                <li class="type-button flex-double-center" @click="selectResetType(0)">
                    <div class="type-icon"></div>
                    <div class="type-text">
                        <div class="type-title"><%= LANG('我忘记资金密码了')%></div>
                        <%= LANG('通过“验证短信”+“身份信息”+“提现银行卡信息”')%>
                    </div>
                </li>
                <li class="type-button flex-double-center" @click="selectResetType(1)">
                    <div class="type-icon"></div>
                    <div class="type-text">
                        <div class="type-title"><%= LANG('我记得原资金密码')%></div>
                        <%= LANG('通过验证支付密码')%>
                    </div>
                </li>
            </ul>
        </div>

        <div class="flex-double-center" v-if="resetType != -1">
            <div class="container-input" v-cloak="">
                <div class="input-title" v-if="resetType == 0"><%= LANG('您正在使用 “验证短信+身份信息+绑定银行卡信息” 进行校验。')%></div>
                <div class="input-title" v-if="resetType == 1"><%= LANG('您正在使用 “验证支付密码” 进行校验。')%></div>
                <div v-if="resetType == 0">
                    <div class="input-box">
                        <div class="input-left-title">
                            <%= LANG('手机号码')%>
                        </div>
                        <input class='input-right' type="text" :placeholder="loginUser.mobile" readonly="readonly">
                    </div>
                    <div class="input-box">
                        <div class="input-left-title">
                            <%= LANG('短信验证码')%>
                        </div>
                        <input class='input-right' type="text">
                    </div>
                    <div class="input-box">
                        <div class="input-left-title">
                            <%= LANG('证件号码')%>
                        </div>
                        <input class='input-right' type="text">
                    </div>
                    <div class="input-box">
                        <div class="input-left-title">
                            <%= LANG('银行卡号')%>
                        </div>
                        <input class='input-right' type="text">
                    </div>
                    <div class="input-box">
                        <div class="input-left-title">
                            <%= LANG('新的资金密码')%>
                        </div>
                        <input class='input-right' type="text">
                    </div>
                    <div class="input-box">
                        <div class="input-left-title">
                            <%= LANG('确认新的资金密码')%>
                        </div>
                        <input class='input-right' type="text">
                    </div>
                    <div class="input-box">
                        <button class="button-big">完成</button>
                    </div>
                </div>

                <div v-if="resetType == 1">
                    <div class="input-box">
                        <div class="input-left-title">
                            <%= LANG('资金密码')%>
                        </div>
                        <input class='input-right' type="password" v-model="fundsInput.oldPassword">
                    </div>
                    <div class="input-box">
                        <div class="input-left-title">
                            <%= LANG('新的资金密码')%>
                        </div>
                        <input class='input-right' type="password" v-model="fundsInput.samePassword">
                    </div>
                    <div class="input-box">
                        <div class="input-left-title">
                            <%= LANG('确认新的资金密码')%>
                        </div>
                        <input class='input-right' type="password" v-model="fundsInput.newPassword">
                    </div>
                    <div class="input-box">
                        <button class="button-big" @click="editFundsPwd()">完成</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    require(['vue', 'common/methods',], function (Vue, Methods) {
        EXX.resetFundsPwd = new Vue({
            el: "#reset-funds-pwd",
            created: function () {

            },
            mounted: function () {

            },
            data: function () {
                return {
                    loginUser: Methods.getLocalUserInfo(),
                    resetType: -1,
                    course: 1,
                    fundsInput: {
                        oldPassword: '',
                        samePassword: '',
                        newPassword: '',
                    },
                }
            },
            computed: {},
            methods: {
                selectResetType: function (type) {
                    this.resetType = type
                    this.course = 1
                },
                auditPassword: function () {
                    if (this.fundsInput.samePassword != this.fundsInput.newPassword) {
                        return
                    }
                },
                editFundsPwd: function (type) {
                    this.auditPassword();
                    var data = {
                        oldPassword: Methods.encryptPwd(this.fundsInput.oldPassword, this.pubKey),
                        newPassword: Methods.encryptPwd(this.fundsInput.newPassword, this.pubKey),
                    }
                    Methods.ajax({
                        type: "POST",
                        url: DOMAIN_DEV + "/exchange/user/controller/website/usercontroller/" + 'setsecuritypassword',
                        data: JSON.stringify(data),
                        success: function (res) {
                            if (res.resMsg.code == 1) {

                            }
                            console.log(res)
                        }.bind(this),
                        error: function (res) {
                            JuaBox.info(EXX.L(res.resMsg.message))
                        }.bind(this)
                    });
                }
            }
        })
    });
</script>