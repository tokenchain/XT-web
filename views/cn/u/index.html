<div id="user-index" class="bk-assets" >
      <div v-if="!loaded" class="vue-table">
          <div class="loading"></div>
      </div>
      <div class="mobile">
      <div v-if="winWidth < 768 && loaded" class="user_center"  v-cloak>
          <div class="user_center_head">
          <div class="tab">
              <p @click="isMock = false" :class="{active: !isMock}"><%= LANG('实币账户') %></p>
              <p @click="isMock = true" :class="{active: isMock}"><%= LANG('模拟账户') %></p>
          </div>
          </div>
          <div class="all"  v-if="loginUser.userType == 1 && !isMock" v-cloak >
              <div class="verification">
                  <p @click="openModal('setMobile')" class="mobile" :class="{on: loginUser.mobileAuth == 1 }"><i class="iconfont icon-icon31"></i><span><%= LANG('手机') %></span></p>
                  <p @click="setEmail" class="email" :class="{on: loginUser.emailAuth == 1 }"><i class="iconfont icon-youxiang1"></i><span><%= LANG('邮箱')%></span></p>
                  <p class="google"  @click="openModal('setGoogle')" :class="{on: loginUser.googleAuth == 1 }"><i class="iconfont icon-guge"></i><span>Google</span></p>
                  <p @click="openModal('setloginpwd')" class="mobile" :class="{on: loginUser.loginPwd == 1 }"><i class="iconfont icon-password"></i><span><%= LANG('登录密码') %></span></p>
              </div>
              <div class="info">
                  <h3><%= LANG('所有账户') %></h3>
                  <p>{{currencySymbol(currentPriceType)}}{{priceDisplay(allTotal, currentPriceType).toFixed(3)}}</p>
              </div>

          </div>

          <div class="user_account_list">

              <div class="user_account_item"  v-for="(account, index) in formatUserAssets" :class="'user-type-' + account.userType"  v-cloak>
                  <div class="head">
                      <div class="user_info">
                          <div class="avatar">
                              <div v-if="account.userType == '3'" class="gray-mask"><%= LANG('模拟') %></div>
                              <img v-if="account.photo" :src="avatarBaseUrl + account.photo" />
                          </div>
                          <h3>{{account.nickName}}</h3>
                          <div class="oper">
                              <a href="javascript:;"  @click="editUser(account.userId)"><i class="iconfont icon-edit"></i></a>
                              <a href="javascript:;"  @click="openBill(account.userId)"><i class="iconfont icon-icon15"></i><span><%= LANG('账单') %></span></a>
                          </div>
                      </div>

                      <div class="capital_info">
                          <h3><%= LANG('账户净资产') %></h3>
                          <p><span>{{resetCurrency(account.assistCoin).toUpperCase()}}</span>{{priceDisplay(account.userBtcNetTotal, account.assistCoin).toFixed(3)}}</p>
                      </div>
                  </div>

                  <div class="user_account_info">
                      <template  v-for="(item, index) in userCoinFunds(account)" >
                          <div @click="toggleCoinDetail(item.coin, account)" class="item" :class="{active: mShowCoinDetail == [item.coin, account.userId].join('_')}">
                              <div class="coinname">
                                  <img :src="'<%= STATIC %>/images/icon/market-icon/market-' + item.coin + '.png'" class="market-icon" />
                                  <h3>{{getRealCoinName(item.coin).toUpperCase()}}</h3>
                              </div>
                              <div class="total"><span><%= LANG('总额') %>：</span>{{Number(item.total)}}
                                  <!--<template v-if="account.assistCoin != 'none'">({{currencySymbol(account.assistCoin) + item.computeTotal.toFixed(3)}})</template>-->
                              </div>
                              <div class="arrow"></div>
                          </div>
                          <template v-if="mShowCoinDetail == [item.coin, account.userId].join('_')">
                              <div class="item_box">
                                  <ul>
                                      <li>
                                          <span><%= LANG('净总额') %>：</span>
                                          {{Number(item.netTotal)}}
                                          <!--<template v-if="account.assistCoin != 'none'">({{currencySymbol(account.assistCoin) + item.computeNetTotal.toFixed(3)}})</template>-->
                                      </li>
                                      <li>
                                          <span><%= LANG('可用') %>：</span>
                                          {{Number(item.available)}}
                                          <!--<template v-if="account.assistCoin != 'none'">({{currencySymbol(account.assistCoin) + item.computeAvailable.toFixed(3) }})</template>-->
                                      </li>
                                      <li>
                                          <span><%= LANG('冻结') %>：</span>
                                          {{Number(item.freez)}}
                                          <!--<template v-if="account.assistCoin != 'none'">({{currencySymbol(account.assistCoin) + item.computeFreez.toFixed(3)}})</template>-->
                                      </li>
                                  </ul>

                                  <div class="account_progress">
                                      <circular-progress :completed-steps="getProportion(account, item) * 100" :total-steps="10000" :diameter="60" :stroke-width="4" inner-stroke-color="#eaeaea" start-color="#fba81c" stop-color="#fba81c" >{{getProportion(account, item)}}</circular-progress>
                                      <p>占比</p>
                                  </div>
                                  <div class="item_box_btn">
                                      <template v-if="account.userType == 1 && item.coin == 'usdx'">
                                          <a class="payinbtn" onclick="JuaBox.info('Coming Soon...')"><%= LANG('兑入') %></a>
                                          <a onclick="JuaBox.info('Coming Soon...')"><%= LANG('兑出') %></a>
                                          <a @click="openBill(account.userId, item.coin)"><%= LANG('账单') %></a>
                                      </template>
                                      <template v-if="account.userType == 1 && item.coin != 'usdx'">
                                          <a class="payinbtn" @click="openPayin(item.coin)"><%= LANG('充值') %></a>
                                          <a @click="openPayout(item.coin)"><%= LANG('提币') %></a>
                                          <a @click="openBill(account.userId, item.coin)" ><%= LANG('账单') %></a>
                                      </template>
                                      <template v-if="account.userType != 1 && loginUser.userType == 1">
                                          <a class="payinbtn" @click="transfer('in', account.userId, item.coin )" ><%= LANG('划入') %></a>
                                          <a @click="transfer('out', account.userId, item.coin)" ><%= LANG('划出') %></a>
                                          <a @click="openBill(account.userId, item.coin)" ><%= LANG('账单') %></a>
                                      </template>
                                      <template  v-if="account.userType != 1 && loginUser.userType != 1">
                                          <a @click="openBill(account.userId, item.coin)" ><%= LANG('账单') %></a>
                                      </template>
                                      <a @click="editMainUserCoin('0', item.fundsType, account.userId)"><%= LANG('隐藏') %></a>
                                  </div>
                              </div>
                          </template>
                      </template>

                      <div class="item hide-coin" v-for="(item, index) in userHidedCoins(account)" v-if="showHidedCoins == account.userId" >
                          <div class="coinname">
                              <img :src="'<%= STATIC %>/images/icon/market-icon/market-' + item.coin + '.png'" class="market-icon" />
                              <h3>{{getRealCoinName(item.coin).toUpperCase()}}</h3>
                          </div>
                          <!--<div class="total"><span>总额：</span>{{Number(item.total)}} <template v-if="account.assistCoin != 'none'">({{currencySymbol(account.assistCoin) + item.computeTotal.toFixed(3)}})</template></div>-->
                          <div class="add_coin" @click="editMainUserCoin('1', item.fundsType, account.userId)"><span></span></div>
                      </div>
                      <div v-if="userHidedCoins(account).length" :class="{'show-hide': showHidedCoins == account.userId}" @click="toggleHidedCoins(account.userId)" class="more"><a></a></div>
                  </div>
              </div>

              <div  @click="addUser(isMock)" class="add_account">
                  <div class="text">
                      <h4><%= LANG('新建独立账户') %></h4>
                      <p><%= LANG('新的独立账号可以用于代理投资、分仓管理等') %></p>
                  </div>
              </div>

          </div>

      </div>
  </div>

      <div class="page-wrapper"  v-if="winWidth > 768 && loaded" v-cloak>
          <div class="account-tabs">
              <ul>
                  <li @click="isMock = false" :class="{active: !isMock}"><a><%= LANG('实币账户') %></a></li>
                  <li @click="isMock = true" :class="{active: isMock}"><a><%= LANG('模拟账户') %></a></li>
              </ul>
          </div>
          <div class="vue-main">
              <div v-if="loginUser.userType == 1 && !isMock" v-cloak  class="account-all clearfix">
                  <div class="ld">
                      <div class="s-hd">
                          <span><%= LANG('所有账户') %></span>
                      </div>
                      <div class="s-bd user-info">
                          <div class="accout-num" v-cloak>{{currencySymbol(currentPriceType)}} {{priceDisplay(allTotal, currentPriceType).toFixed(3)}}</div>
                          <div class="tips-coin coin-dropdown">
                              <div @click="openCurrencyList('all')" class="currency">
                                  <%= LANG('价格显示') %>: <b v-cloak>{{currentPriceType.toUpperCase()}}</b> <i class="iconfont icon-jiantou"></i>
                              </div>
                              <transition name="fadeInUp" v-cloak>
                                  <ul v-if="showCurrencyList == 'all'" class="dropdown select-currency" v-cloak>
                                      <li v-for="coin in currencyList" @click="setCurrency(coin)"><i :class="'iconfont ' + coin.icon"></i>{{coin.name.toUpperCase()}}</li>
                                  </ul>
                              </transition>
                          </div>
                          <div v-if="false" class="add-account">
                              <a @click="addUser(false)" data-toggle="tooltip" data-placement="top" title="<%= LANG('添加子账号') %>" class="abtn" ><i>+</i></a>
                          </div>
                      </div>
                  </div>
                  <div class="rd">
                      <!--<div class="onffflist">-->
                      <!--<a :class="{on: loginUser.loginAuth > 3}" @click="openModal('setRemoteLogin')"><i></i><span>异地验证</span></a>-->
                      <!--<a :class="{on: loginUser.safePwd == 1}"  @click="openModal('openSafePwd')"  ><i></i><span>二级密码</span></a>-->
                      <!--<a :class="{on: loginUser.payoutAuth == 1 || loginUser.payoutAuth == 3 }" @click="openModal('payMobileAuth')" ><i></i><span>提现手机验证</span></a>-->
                      <!--</div>-->
                      <div class="iconlist" v-if="loginUser.userType == 1 && !isMock">
                          <a @click="openModal('setMobile')" class="mobile" :class="{on: loginUser.mobileAuth == 1 }"><i class="iconfont icon-icon31"></i><span><%= LANG('手机') %></span></a>
                          <a @click="setEmail" class="email" :class="{on: loginUser.emailAuth == 1 }"><i class="iconfont icon-youxiang1"></i><span><%= LANG('邮箱')%></span></a>
                          <!--
                          <a class="tname" :class="{on: loginUser.realAuth != 0 }"><i class="iconfont icon-shimingrenzheng"></i><span>实名</span></a>
                          -->
                          <a class="google"  @click="openModal('setGoogle')" :class="{on: loginUser.googleAuth == 1 }"><i class="iconfont icon-guge"></i><span>Google</span></a>

                          <a @click="openModal('setloginpwd')" class="mobile" :class="{on: loginUser.loginPwd == 1 }"><i class="iconfont icon-password"></i><span><%= LANG('登录密码') %></span></a>

                          <!--<a @click="openModal('safepassword')" class="mobile" :class="{on: loginUser.safePwdAuth == 1 }"><i class="iconfont icon-anquan1"></i><span><%= LANG('二级密码') %></span></a>-->

                          <!--<a class="safeset"  @click="openModal('safeset')" ><i class="iconfont icon-anquan"></i><span>安全设置</span></a>-->

                      </div>

                  </div>
              </div>

              <div v-for="(account, index) in formatUserAssets" class="user-card" :class="'user-type-' + account.userType"  v-cloak>
                  <div class="card-title">
                      <div class="row">
                          <div class="user-info col-sm-6">
                              <div @click="linkToMarket(account)" class="avatar">
                                  <div v-if="account.userType == '3'" class="gray-mask"><%= LANG('模拟') %></div>
                                  <img v-if="account.photo" :src="avatarBaseUrl + account.photo" />
                                  <img v-else :src="avatarBaseUrl + 'default.jpg'" />
                              </div>
                              <div class="info">
                                  <div class="user-memo">
                                      <template v-if="account.userType === 1">
                                          {{account.nickName || account.nickName== '' ? account.nickName : '<%= LANG('主账户') %>' }}
                                      </template>
                                      <template v-else>
                                          {{account.nickName!= '' ? account.nickName : account.userName}}
                                      </template>
                                      <div class="actions-group">
                                          <a @click="editUser(account.userId)" class="abtn-edit" title="<%= LANG('编辑') %>"  data-toggle="tooltip" data-placement="top" ><i class="iconfont icon-edit"></i></a>
                                          <div class="actions-btn-childlogin">
                                              <a v-if="account.userType != '1'" @click="toggleLogin(account.userId)" class="abtn-edit" :class="{on: account.childLogin}" title="<%= LANG('登录设置') %>"  data-toggle="tooltip" data-placement="top" ><i class="iconfont icon-dairenzheng"></i></a>
                                              <a v-if="account.userType != '1'" @click="toggleLever(account.userId)" class="abtn-edit" :class="{on: account.lever}" title="<%= LANG('杠杆设置') %>"  data-toggle="tooltip" data-placement="top" ><i class="iconfont icon-genggaiganggan"></i></a>
                                          </div>
                                          <!--<a title="删除"><i class="iconfont icon-trash"></i></a>
                                          <a @click="openCoin(account.userId)" class="abtn abtn-add" data-toggle="tooltip" data-placement="top" title="<%= LANG('管理该用户的币种') %>"><i class="iconfont icon-bitcoin"></i><span><%= LANG('币种管理') %></span></a>
                                          -->
                                          <a @click="openBill(account.userId)" class="abtn abtn-account" data-toggle="tooltip" data-placement="top" title="<%= LANG('管理该用户的账单') %>"><i class="iconfont icon-icon15"></i><span><%= LANG('账单管理') %></span></a>
                                          <!--<a class="abtn abtn-less" data-toggle="tooltip" data-placement="top" title="删除您现在的币种"><i class="iconfont icon-bitcoin"></i>币种删除</a>-->
                                          <!--<a class="abtn abtn-account" data-toggle="tooltip" data-placement="top" title="删除您现在的币种"><i class="iconfont icon-yonghu"></i>子账号管理</a>-->
                                      </div>
                                  </div>
                                  <div class="user-name">{{getUserInfo(account.userId).userName}}</div>
                                  <div @click="openCurrencyList(account.userId)" class="tips-coin coin-dropdown">
                                      <div class="currency">
                                          <%= LANG('价格显示') %>: <b v-cloak>{{resetCurrency(account.assistCoin).toUpperCase()}}</b>
                                          <i class="iconfont icon-jiantou" ></i>
                                      </div>
                                      <transition name="fadeInUp" v-cloak>
                                          <ul v-if="showCurrencyList == account.userId" class="dropdown select-currency" v-cloak>
                                              <li v-for="coin in currencyList" @click="setCurrency(coin, account.userId)"><i :class="'iconfont ' + coin.icon"></i>{{coin.name.toUpperCase()}}</li>
                                          </ul>
                                      </transition>
                                  </div>
                              </div>
                          </div>
                          <div class="assets-info col-sm-6">
                              <div class="row">
                                  <div class="col-sm-12">
                                      <div class="netasset">
                                          <div class="assets-chart"><span class="linebar">5,3,9,6,5,9,7,3,5,2</span></div>
                                          <div class="text">
                                              <div class="num" v-cloak><span>{{resetCurrency(account.assistCoin).toUpperCase()}}</span><b>{{priceDisplay(account.userBtcNetTotal, account.assistCoin).toFixed(3)}}</b></div>
                                              <div class="name"><%= LANG('账户净资产') %></div>
                                              <!--<div class="sline"><i class="iconfont icon-arrowll-copy"></i></div>-->
                                          </div>
                                      </div>

                                      <div class="onffflist">
                                          <a :class="{on: account.childLogin}" v-if="account.userType == 2 && loginUser.userType == 1" @click="toggleLogin(account.userId)" ><i></i><span><%= LANG('登录设置') %></span></a>
                                          <a :class="{on: account.lever }" v-if="account.userType != 1" @click="toggleLever(account.userId)"  ><i></i><span><%= LANG('杠杆设置') %></span></a>
                                      </div>

                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="card-body">
                      <!--<json-grid class="user-assets" :settings="assetsTableSettings"  :columns="getAssetsCol(account.userId, getUserInfo(account.userId).userType, getUserInfo(account.userId).assistCoin)" :rows="userCoinFunds(account)" ></json-grid>-->
                      <div class="vue-grid user-assets">
                          <div class="theader">
                              <div class="th cointTag">
                                  <div class="cell"><%= LANG('币种') %></div>
                              </div>
                              <div class="th total">
                                  <div class="cell "><%= LANG('总额') %></div>
                              </div>
                              <div class="th nettotoal">
                                  <div class="cell"><%= LANG('净总额') %></div>
                              </div>
                              <div class="th proportion">
                                  <div class="cell"><%= LANG('占比') %></div>
                              </div>
                              <div class="th useable">
                                  <div class="cell"><%= LANG('可用') %></div>
                              </div>
                              <div class="th frozen">
                                  <div class="cell"><%= LANG('冻结') %></div>
                              </div>
                              <div class="th loan" v-if="account.lever">
                                  <div class="cell"><%= LANG('借入') %></div>
                              </div>
                              <div class="th action">
                                  <div class="cell"><%= LANG('操作') %></div>
                              </div>
                          </div>

                          <div class="tbody">
                              <div class="tr" v-for="(item, index) in userCoinFunds(account)">
                                  <div class="td cointTag">
                                      <div class="cell">
                                          <img :src="'<%= STATIC %>/images/icon/market-icon/market-' + item.coin + '.png'" class="market-icon" />
                                          <b>{{getRealCoinName(item.coin).toUpperCase()}}</b>
                                          <a class="act" @click="editMainUserCoin('0', item.fundsType, account.userId)"><%= LANG('隐藏') %></a>
                                      </div>
                                  </div>
                                  <div class="td total">
                                      <div class="cell">
                                          <span :title="'<%= LANG('折合') %>' + (currencySymbol(account.assistCoin) + item.computeTotal.toFixed(3))">{{Number(item.total)}}</span>
                                          <!--<template v-if="account.assistCoin != 'none'">({{currencySymbol(account.assistCoin) + item.computeTotal.toFixed(3)}})</template>-->
                                      </div>
                                  </div>
                                  <div class="td nettotoal">
                                      <div class="cell">
                                          <span :title="'<%= LANG('折合') %>' + (currencySymbol(account.assistCoin) + item.computeNetTotal.toFixed(3))">{{Number(item.netTotal)}}</span>
                                          <!--<template v-if="account.assistCoin != 'none'">({{currencySymbol(account.assistCoin) + item.computeNetTotal.toFixed(3)}})</template>-->
                                      </div>
                                  </div>
                                  <div class="td proportion">
                                      <div class="cell">
                                          <div class="exx-progress-bar">
                                              <div class="progress-bar-wraper">
                                                  <div class="progress-bar-inner" :style="'width: ' + getProportion(account, item) + '%;'"></div>
                                              </div>
                                              <span class="progress-text">{{getProportion(account, item)}}%</span></div>
                                      </div>
                                  </div>
                                  <div class="td useable">
                                      <div class="cell">
                                          <span :title="'<%= LANG('折合') %>' + (currencySymbol(account.assistCoin) + item.computeAvailable.toFixed(3))">{{Number(item.available)}}</span>
                                          <!--<template v-if="account.assistCoin != 'none'">({{currencySymbol(account.assistCoin) + item.computeAvailable.toFixed(3) }})</template>-->
                                      </div>
                                  </div>
                                  <div class="td frozen">
                                      <div class="cell">
                                          <span :title="'<%= LANG('折合') %>' + (currencySymbol(account.assistCoin) + item.computeFreez.toFixed(3))">{{Number(item.freez)}}</span>
                                          <!--<template v-if="account.assistCoin != 'none'">({{currencySymbol(account.assistCoin) + item.computeFreez.toFixed(3)}})</template>-->
                                      </div>
                                  </div>
                                  <div class="td loan" v-if="account.lever">
                                      <div class="cell">
                                          <span :title="'<%= LANG('折合') %>' + (currencySymbol(account.assistCoin) + item.computeLoanIn.toFixed(3))">{{Number(item.loanIn)}}</span>
                                          <!--<template v-if="account.assistCoin != 'none'">({{currencySymbol(account.assistCoin) + item.computeLoanIn.toFixed(3)}})</template>-->
                                          <a v-if="Number(item.loanIn) > 0" @click="openRefund(account.userId, item.coin)"><%= LANG('还款') %></a>
                                      </div>
                                  </div>
                                  <div class="td action">
                                      <div class="cell">
                                          <template v-if="account.userType == 1 && item.coin == 'usdx'">
                                              <a class="btn btn-primary btn-sm" onclick="JuaBox.info('Coming Soon...')"><%= LANG('兑入') %></a>
                                              <a class='xiahuaxian' onclick="JuaBox.info('Coming Soon...')"><%= LANG('兑出') %></a>
                                              <a class='xiahuaxian' @click="openBill(account.userId, item.coin)"><%= LANG('账单') %></a>
                                          </template>
                                          <template v-if="account.userType == 1 && item.coin != 'usdx'">
                                              <a class="btn btn-primary btn-sm" @click="openPayin(item.coin)"><%= LANG('充值') %></a>
                                              <a class='xiahuaxian' @click="openPayout(item.coin)"><%= LANG('提币') %></a>
                                              <a class='xiahuaxian' @click="openBill(account.userId, item.coin)" ><%= LANG('账单') %></a>
                                          </template>
                                          <template v-if="account.userType != 1 && loginUser.userType == 1">
                                              <a class='xiahuaxian' @click="transfer('in', account.userId, item.coin )" ><%= LANG('划入') %></a>
                                              <a class='xiahuaxian' @click="transfer('out', account.userId, item.coin)" ><%= LANG('划出') %></a>
                                              <a class='xiahuaxian' @click="openBill(account.userId, item.coin)" ><%= LANG('账单') %></a>
                                          </template>
                                          <template  v-if="account.userType != 1 && loginUser.userType != 1">
                                              <a class='xiahuaxian' @click="openBill(account.userId, item.coin)" ><%= LANG('账单') %></a>
                                          </template>
                                      </div>
                                  </div>
                              </div>

                              <div class="tr  hide-coin" v-for="(item, index) in userHidedCoins(account)" v-if="showHidedCoins == account.userId">
                                  <div class="td cointTag">
                                      <div class="cell">
                                          <img :src="'<%= STATIC %>/images/icon/market-icon/market-' + item.coin + '.png'" class="market-icon" />
                                          <b>{{getRealCoinName(item.coin).toUpperCase()}}</b>
                                      </div>
                                  </div>
                                  <div class="td total">
                                      <div class="cell">0(¥0.000)</div>
                                  </div>
                                  <div class="td nettotoal">
                                      <div class="cell">0(¥0.000)</div>
                                  </div>
                                  <div class="td proportion">
                                      <div class="cell"></div>
                                  </div>
                                  <div class="td useable">
                                      <div class="cell">0(¥0.000)</div>
                                  </div>
                                  <div class="td frozen">
                                      <div class="cell">0(¥0.000)</div>
                                  </div>
                                  <div class="td loan"  v-if="account.lever">
                                      <div class="cell">0(¥0.000)</div>
                                  </div>
                                  <div class="td action">
                                      <div class="cell">
                                          <a class="btn btn-primary btn-sm" @click="editMainUserCoin('1', item.fundsType, account.userId)"><%= LANG('显示到账户主屏') %></a>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>

                  </div>
                  <div v-if="userHidedCoins(account).length" :class="{'show-hide': showHidedCoins == account.userId}" class="table-morelist"><a role="button" @click="toggleHidedCoins(account.userId)" ><i v-if="showHidedCoins == account.userId" class="iconfont icon-expand_less"></i><i v-else class="iconfont icon-expand_more"></i></a></div>
              </div>
              <div @click="addUser(isMock)" class="add-account-bar">
                  <div class="inner">
                      <div class="icon-col">
                          <i class="iconfont icon-zhuceyaoqing"></i>
                      </div>
                      <div class="text-col">
                          <h4><%= LANG('新建独立账户') %></h4>
                          <p class="desc"><%= LANG('新的独立账号可以用于代理投资、分仓管理等') %></p>
                      </div>
                  </div>
              </div>
      </div>




    </div>

    <modal v-cloak :open= "showModal == 'userAction'" @close="showModal = false">
      <user-action :params="userParams" :done="userActionSuccess()" />
    </modal>

    <modal v-cloak :open= "showModal == 'toggleUserAction'" @close="showModal = false">
      <toggle-user-action :params="userParams" :done="userActionSuccess()" />
    </modal>

    <modal v-cloak :open="showModal == 'setMobile'" @close="showModal = false">
      <set-mobile :done="setMobileSuccess()" />
    </modal>

    <modal v-cloak :open="showModal == 'payMobileAuth'" @close="showModal = false">
      <paymobile />
    </modal>

    <modal v-cloak :open="showModal == 'setGoogle'" @close="showModal = false">
      <set-google />
    </modal>

    <modal v-cloak :open="showModal == 'setEmail'"  @close="showModal = false">
      <set-email />
    </modal>

    <modal v-cloak :open="showModal == 'safepassword'" @close="showModal = false">
      <safepassword />
    </modal>

    <modal v-cloak :open= "showModal == 'addMarket'" @close="showModal = false">
      <add-market :params="marketParams" />
    </modal>

    <modal v-cloak :open="showModal == 'addCoin'"  @close="showModal = false">
      <add-coin :params="coinParams" />
    </modal>

    <modal v-cloak :open= "showModal == 'transfer'" @close="showModal = false">
      <transfer :info="transferInfo" :accounts="accountsList" :done="transferSuccess()" />
    </modal>

    <modal v-cloak :open= "showModal == 'payin'" @close="showModal = false">
      <modal-payin :coin="payinCoin" :done="callCloseModal()" />
    </modal>

    <modal v-cloak :open= "showModal == 'payout'" @close="showModal = false">
      <modal-payout ref="payout" :coin="payoutCoin" />
    </modal>

    <modal v-cloak :open="showModal == 'bill'"  @close="showModal = false">
      <bill :params="billParams" theme="light" />
    </modal>

    <modal v-cloak :open= "showModal == 'refund'" @close="showModal = false">
      <modal-refund :params="refundParams" :assets="userAssets" :done="callCloseModal()" />
    </modal>

    <modal v-cloak :open="showModal == 'safeset'"  @close="showModal = false">
      <safeset />
    </modal>

    <modal v-cloak :open="showModal == 'setloginpwd'"  @close="showModal = false">
      <setloginpwd />
    </modal>

  </div>


</div>

<%-include("../component/json_grid.html")%>
<%-include("../component/json_table.html")%>
<%-include("../component/send_code.html")%>
<%-include("../component/page_lite.html")%>
<%-include("../component/modal.html")%>
<%-include("../component/circular_progress.html")%>

<%-include("model/userAction.html")%>
<%-include("model/toggleUserAction.html")%>
<%-include("model/setMobile.html")%>
<%-include("model/payMobileAuth.html")%>
<%-include("model/setgoogle.html")%>
<%-include("model/email.html")%>
<%-include("model/addcoin.html")%>
<%-include("model/safePassword.html")%>
<%-include("model/insideDebit.html")%>
<%-include("model/payin.html")%>
<%-include("model/payout.html")%>
<%-include("model/bill.html")%>
<%-include("model/refund.html")%>
<%-include("model/safeset.html")%>
<%-include("model/setLoginPwd.html")%>
<%-include("../activity/_addMarket.html")%>



  <script>
      $(function(){
          if( $('.mask span').text() <= 50 ){
              $('.circle_right').css('transform','rotate('+($('.mask span').text()*3.6)+'deg)');
          }else{
              $('.circle_right').css({
                  'transform':'rotate(0deg)',
                  "background":"#fba81c"
              });
              $('.circle_left').css('transform','rotate('+(($('.mask span').text()-50)*3.6)+'deg)');
          }
      })
  </script>


<script>

  $(function(){
    $.fn.peity.defaults.bar = {
      delimiter: ",",
      fill: ["#414253"],
      height: 32,
      max: null,
      min: 0,
      padding: 0.1,
      width: 60
    };
    $(".linebar").peity("bar");
  });


  require(['vue', 'common/methods', 'common/juabox', 'components/country_code/index'], function(Vue, Methods, JuaBox) {

    //释放JuaBox到全局使用
    window.JuaBox = JuaBox;



    EXX.userIndex = new Vue({
      el: "#user-index",
      data: function () {
        return {
            loaded: false,
          pubKey: '',
            timer: false,
          showModal: false,
          showCurrencyList: false,
            showHidedCoins: false,
            mShowCoinDetail: false,
          avatarBaseUrl: '<%= STATIC %>/images/userhead/',
          repaymentAmount: '',
            winWidth: window.innerWidth,
            isMock: false,
          currentPriceType : MONEY,
          userAssets: [],
            mainUserAssets: [],
          allPriceRate: {
            btc : {
              btc : 0,
              ltc : 0,
              eth : 0,
              etc : 0
            },
            cny : {
              btc : 0,
              ltc : 0,
              eth : 0,
              etc : 0
            },
            usd : {
              btc : 0,
              ltc : 0,
              eth : 0,
              etc : 0
            }
          },
          loginUser: Methods.getLocalUserInfo(),
          allSubAccounts: [],
          safePwd: '',
          dynamicCode: '',
          googleCode: '',
          payinCoin: '',
          payoutCoin: '',
          billParams: {},
          refundParams: {},
          coinParams: {},
          userParams: {},
          marketParams: {},
          transferInfo: {},
          editAccountInfo: {},
          allMarketsInfo: [],
            currencyList: [
                {key:'none', name: "<%= LANG('原始')%>", icon: '', symbol: '฿',decimal : 6},
                {key: 'usd', name: 'USD', icon: 'icon-meiyuan', symbol: '$',decimal : 2},
                {key: 'cny', name: 'CNY', icon: 'icon-cny', symbol: '¥',decimal : 2}
            ],
          assetsTableSettings: {
            rowClass: function(item) {
              return item.cointTag;
            }
          }
        }
      },
      computed: {
        accountsList: function() {
          var accounts = [];
          if (this.userAssets.length) {
            this.userAssets.map(function(user){
              var label = user.nickName ? user.nickName : user.userName;
              var obj = {};
              obj.label = label;
              obj.value = user.userId;
              obj.userName = user.userName;
              obj.userId = user.userId;
              obj.nickName= user.nickName;
              obj.photo = user.photo;
              obj.userType = user.userType;
              obj.isVirtual = user.isVirtual;
              obj.isLever = user.isLever;
              obj.isChildLogin = user.isChildLogin;
              obj.assistCoin = user.assistCoin;
              accounts.push(obj);
            });
          }
          return accounts;
        },
        allMarkets: function() {
          var markets = [];
          this.allMarketsInfo.map(function(item){
            markets.push(item.type);
          });
          return markets;
        },
        leverTypes: function() {
          var types = [
            {'label': '<%= LANG("不启用") %>', 'value': ''}
          ];
          [].map(function(market){
            var obj = {};
            obj.label = market.type.toUpperCase().replace(/_/, '/');
            obj.value = market.type;
            types.push(obj);
          });
          return types;
        },
        // 计算各币种的BTC折合
        formatUserAssets: function() {
          var oriUserAssets = this.userAssets;
          var userAssets = [];
          //过滤真实用户或模拟用户
          if (this.isMock) {
              userAssets = oriUserAssets.filter(function(user){
                  return user.userType == 3;
              })
          } else {
              userAssets = oriUserAssets.filter(function(user){
                  return user.userType != 3;
              })
          }
          var assets = [];
          userAssets.map(function(user){
            var cUser = user;
            cUser.userBtcNetTotal = 0;
            var coinFundMap = cUser.coinFundMap;
            var coins = Object.keys(cUser.coinFundMap);
            coins.map(function(coin){
              var coinObj = coinFundMap[coin];
              var btcPrice = this.moneyPrice('btc', coin);
              cUser.coinFundMap[coin].btcNetTotal = coinObj.total == 0 ? 0 : (coinObj.total - coinObj.loanIn) * btcPrice;
              cUser.userBtcNetTotal += coinObj.total == 0 ? 0 : (coinObj.total - coinObj.loanIn) * btcPrice;
            }.bind(this));
            assets.push(cUser);
          }.bind(this));
          return assets;
        },
        //所有用户资产总和(btc)
        allTotal: function() {
          var total = 0;
          this.formatUserAssets.map(function(user){
            total += user.userBtcNetTotal;
          });
          return total;
        },
          mainUserInfo: function() {
            var mainUser = this.accountsList.filter(function(user){
                return user.userType == 1;
            });
            return mainUser;
          },
          mainUserHideAssets: function() {
            return this.mainUserAssets.hidePays;
          },
          mainUserShowAssets: function() {
              var mainUserAssets = this.mainUserAssets.showPays;
              if (mainUserAssets) {
                  var coinFundMap = mainUserAssets.coinFundMap;
                  var coins = Object.keys(coinFundMap);
                  mainUserAssets.userBtcNetTotal = 0;
                  coins.map(function(coin){
                      var coinObj = mainUserAssets.coinFundMap[coin];
                      var btcPrice = this.moneyPrice('btc', coin);
                      var moneyPrice = this.moneyPrice(mainUserAssets.assistCoin, coin);
                      var obj = coinFundMap[coin];
                      obj.computeTotal = obj.total * moneyPrice;
                      obj.computeNetTotal = obj.total == 0 ? 0 : (obj.total - obj.loanIn) * moneyPrice;
                      obj.netTotal = obj.total == 0 ? 0 : Methods.fixFloat((obj.total - obj.loanIn), 8);
                      obj.computeAvailable = obj.available * moneyPrice;
                      obj.computeLoanIn = obj.loanIn * moneyPrice;
                      obj.computeFreez = obj.freez * moneyPrice;
                      obj.coin = coin;

                      mainUserAssets.userBtcNetTotal += coinObj.total == 0 ? 0 : (coinObj.total - coinObj.loanIn) * btcPrice;
                  }.bind(this));
              }
              return mainUserAssets;
          }
      },
        watch: {
          showModal: function(value) {
              // 添加class控制弹窗时不滚动主页内容
              if (value) {
                  $('body').addClass('modal-open');
              } else {
                  $('body').removeClass('modal-open');
              }
          }
        },
      methods: {
        //去掉虚拟市场货币的D字符
        getRealCoinName : function (coin) {
            if(coin.length > 3 && coin.substring(0,1) == 'd'){
                return coin.substring(1);
            }else{
                return coin;
            }
        },
        // getUserInfo: function(id) {
        //   return this.userAssets.getObject('userId', id);
        // },
        currencySymbol: function(currency) {
          return this.currencyList.getObject('key', currency).symbol;
        },
        // 格式化用户资产数据
        userCoinFunds: function(user, index) {
          var fundMaps = user.coinFundMap;
          var assistCoin = user.assistCoin;
          var arr = [];
          var allComputeNetTotal = 0;
          Object.keys(fundMaps).map(function(coin){
            var moneyPrice = this.moneyPrice(assistCoin, coin);
            var obj = fundMaps[coin];
            if (obj.showCoin) {
              obj.computeTotal = obj.total * moneyPrice;
              obj.computeNetTotal = obj.total == 0 ? 0 : (obj.total - obj.loanIn) * moneyPrice;
              allComputeNetTotal += obj.computeNetTotal;
              obj.netTotal = obj.total == 0 ? 0 : Methods.fixFloat((obj.total - obj.loanIn), 8);
              obj.computeAvailable = obj.available * moneyPrice;
              obj.computeLoanIn = obj.loanIn * moneyPrice;
              obj.computeFreez = obj.freez * moneyPrice;
              obj.coin = coin;
              arr.push(obj);
            }
          }.bind(this));
          //this.userAssets[index].allComputeNetTotal = allComputeNetTotal;
          //console.log(this.userAssets);
          return arr;
        },
          userHidedCoins: function(user) {
              var fundMaps = user.coinFundMap;
              var hidedCoins = [];
              Object.keys(fundMaps).map(function(coin) {
                  var obj = fundMaps[coin];
                if (!obj.showCoin) {
                    obj.coin = coin;
                    hidedCoins.push(fundMaps[coin]);
                }
              });
              return hidedCoins;
          },
          getProportion: function(account, item) {
              var userTotal = account.userBtcNetTotal;
              var percentage = userTotal == 0 ? 0 : (Number(item.btcNetTotal) / Number(userTotal) * 100).toFixed(2);
              return percentage;
          },
        getAssetsCol: function(userId, userType, assistCoin) {
            var _this = this;
          var assetCols = [
            { label: "<%= LANG('币种') %>", key: "cointTag", cell: function(item){
              return "<img src='<%= STATIC %>/images/icon/market-icon/market-" + item.coin + ".png' class='market-icon'><b>" + _this.getRealCoinName(item.coin).toUpperCase() + "</b>"
            }},
            { label: "<%= LANG('总额') %>", key: "total", cell: function(item){
              return Number(item.total) + '(' + this.currencySymbol(assistCoin) + item.computeTotal.toFixed(3) +')';
            }.bind(this)},
            { label: "<%= LANG('净总额') %>", key: "nettotal", cell: function(item){
              return Number(item.netTotal) + '(' + this.currencySymbol(assistCoin) + item.computeNetTotal.toFixed(3) +')';
            }.bind(this)},
            { label: "<%= LANG('占比') %>", key: "proportion", cell: function(item) {
              var userTotal = this.getUserInfo(userId).userBtcNetTotal;
              var percentage = userTotal == 0 ? 0 : (Number(item.btcNetTotal) / Number(userTotal) * 100).toFixed(2);
              //var  percentage = 0;
              return "<div class=\"exx-progress-bar\"><div class=\"progress-bar-wraper\"><div class=\"progress-bar-inner\" style=\"width: " + percentage + "%;\"></div></div><span class=\"progress-text\">" + percentage + "%</span></div>"
            }.bind(this)},
            { label: "<%= LANG('可用') %>", key: "usable", cell: function(item){
              return Number(item.available) + '(' + this.currencySymbol(assistCoin) + item.computeAvailable.toFixed(3) +')';
            }.bind(this)},
            { label: "<%= LANG('冻结') %>", key: "frozen", cell: function(item){
              return Number(item.freez) + '(' + this.currencySymbol(assistCoin) + item.computeFreez.toFixed(3) +')';
            }.bind(this)},
            { label: "<%= LANG('借入') %>", key: "loan", cell: function(item){
              return Number(item.loanIn) + '(' + this.currencySymbol(assistCoin) + item.computeLoanIn.toFixed(3) +') <a onclick="EXX.userIndex.openRefund(\'' + userId + '\',\'' + item.coin + '\')"><%= LANG('还款') %></a>';
            }.bind(this)},
            { label: "<%= LANG('操作') %>", key: "action", cell: function(item) {
              var html = "";
              if (userType == 1) {
                //html = "<a href='/u/fund/payin?coint=" + item.propTag + "' class='btn btn-primary btn-sm'>充值</a> <a href='/u/fund/payout?coint=" + item.propTag + "' >提币</a>  <a  >移除</a> <a @click=openModal('bill') >账单</a>"
                if(item.coin == 'usdx'){
                    html = "<a class=\"btn btn-primary btn-sm\" onclick=\"JuaBox.info('Coming Soon...')\"><%= LANG('兑入') %></a><a class='xiahuaxian' onclick=\"JuaBox.info('Coming Soon...')\"><%= LANG('兑出') %></a><a class='xiahuaxian' onclick=\"EXX.userIndex.openBill('" + userId + "','" + item.coin + "')\" ><%= LANG('账单') %></a>"
                }else{
                    html = "<a class=\"btn btn-primary btn-sm\" onclick=\"EXX.userIndex.openPayin('" + item.coin + "')\"><%= LANG('充值') %></a><a class='xiahuaxian' onclick=\"EXX.userIndex.openPayout('" + item.coin + "')\"><%= LANG('提币') %></a><a class='xiahuaxian' onclick=\"EXX.userIndex.openBill('" + userId + "','" + item.coin + "')\" ><%= LANG('账单') %></a>"
                }
              } else if (userType != 1 && this.loginUser.userType == 1) {
                html = "<a class='xiahuaxian' onclick=\"EXX.userIndex.transfer('in', '" + userId + "','" + item.coin + "')\" ><%= LANG('划入') %></a> <a class='xiahuaxian' onclick=\"EXX.userIndex.transfer('out', '" + userId + "','" + item.coin + "')\" ><%= LANG('划出') %></a><a class='xiahuaxian' onclick=\"EXX.userIndex.openBill('" + userId + "','" + item.coin + "')\" ><%= LANG('账单') %></a>";
              } else {
                html = "<a class='xiahuaxian' onclick=\"EXX.userIndex.openBill('" + userId + "','" + item.coin + "')\" ><%= LANG('账单') %></a>"
              }
              return html;
            }.bind(this)}
          ];
          var userInfo = this.getUserInfo(userId);
          if (userType == 1 || !userInfo.lever) {
            assetCols.splice(6,1);
          }
          return assetCols;
        },
        priceDisplay: function(num, money){
          var moneyPrice = this.moneyPrice(money, 'btc');
          return moneyPrice * Number(num);
        },
        resetCurrency: function(coin) {
          return coin != '' ? coin : 'usd';
        },
        moneyPrice: function(money, coin){
          var money = money || 'usd';
          return Number(this.allPriceRate[money] && this.allPriceRate[money][coin] ? this.allPriceRate[money][coin] : 1)
        },
        userEnabledCoin: function(user) {
          var coinFundMap = user.coinFundMap;
          var enabled = [];
          Object.keys(coinFundMap).forEach(function(coin){
            if (coinFundMap[coin].show) {
              coinFundMap[coin]['name'] = coin;
              enabled.push(coinFundMap[coin]);
            }
          });
          return enabled;
        },
        openModal: function(name) {
            if (name == 'setMobile' && this.loginUser.emailAuth == 0) {
                JuaBox.info("<%= LANG('需要先认证邮箱才能修改手机号码。')%>")
                this.showModal = false;
                return
            }
          this.showModal = name;
          //this.$refs[name].open = true;
        },
        callCloseModal: function() {
          return function() {
            this.showModal = false;
          }.bind(this)
        },
        closeModal: function() {
          this.showModal = false;
        },
        linkToMarket: function(account) {
          Methods.setCookie(ENV+'currentAccountId', account.userId);
          window.location.replace('/trade');
        },
        openCurrencyList: function(id) {
          this.showCurrencyList = id;
        },
        openPayin: function(coin) {
          this.showModal = 'payin';
          this.payinCoin = coin;
        },
        openPayout: function(coin) {
          this.showModal = 'payout';
          this.payoutCoin = coin;
        },
        openBill: function(userId, coin) {
          this.billParams = {
            userId: userId,
            coin: coin
          };
          this.showModal = 'bill';
        },
        openRefund: function(userId, coin) {
            this.refundParams = {
                userId: userId,
                coin: coin
            };
            this.showModal = 'refund';
        },
        openAddMarket: function(account) {
          this.showModal = 'addMarket';
          this.showMainHide = false;
          this.marketParams = {
            account: account
          }
        },
        openCoin: function(userId) {
          this.coinParams = {
            userId: userId,
            account: this.getUserInfo(userId),
            allPriceRate: this.allPriceRate
          };
          this.showModal = 'addCoin';
        },
        setEmail: function() {
          if (this.loginUser.emailAuth == 1) {
            return
          }
          this.showModal = 'setEmail';
        },
        addUser: function(isMock) {
          this.userParams = {
            optType: 2,
              isMock: isMock
          };
          this.showModal = 'userAction';
        },
        editUser: function(userId) {
          this.userParams = {
            optType: 3,
            userId: userId,
            account: this.getUserInfo(userId)
          };
          this.showModal = 'userAction';
        },
          toggleCoinDetail: function(coin, account) {
            var targetCoin = [coin, account.userId].join('_');
            if (targetCoin == this.mShowCoinDetail) {
                this.mShowCoinDetail = false;
            } else {
                this.mShowCoinDetail = targetCoin;
            }
          },
        toggleLogin: function(userId) {
          this.userParams = {
            optType: 4,
            userId: userId,
            account: this.getUserInfo(userId)
          };
          this.showModal = 'toggleUserAction';
        },
        toggleLever: function(userId) {
          var account = this.getUserInfo(userId);
          var enabledCoins = this.userEnabledCoin(account);
          this.userParams = {
            optType: 5,
            userId: userId,
            account: account
          };
          if (enabledCoins.length == 0) {
            JuaBox.info("<%= LANG('开启杠杆需要添加一个交易市场') %>");
            this.openAddMarket(account);
          } else if (enabledCoins.length > 2) {
            JuaBox.info("<%= LANG('开启杠杆只能应用于一个市场，请把多余的市场删除') %>");
            this.openAddMarket(account);
          } else {
            this.showModal = 'toggleUserAction';
          }
        },
          toggleHidedCoins: function(userId) {
            this.showHidedCoins = this.showHidedCoins == userId ? false : userId;
          },
        editAccount: function(userId) {
          this.showModal = 'addAccount';
          this.editAccountInfo = {
            type: 'edit',
            account: this.getUserInfo(userId),
            userId: userId
          }
        },
        getPubKey: function () {
            Methods.ajax({
                type: 'GET',
                url: DOMAIN_DEV + "/exchange/website/common/baseapicontroller/" + 'getpubkey',
                success: function (res) {
                    this.pubKey = res.datas.pubKey;
                }.bind(this)
            });
        },
        getAllMarketsInfo: function() {
          Methods.getJSONP({
            url: DOMAIN_TRADE + API_PREFIX + 'allMarket',
            success: function (res) {
              this.allMarketsInfo = res.datas
            }.bind(this)
          });
        },
        // 获取币价汇率
        getPriceRate: function(callback) {
          Methods.ajax({
              url: DOMAIN_DEV + "/exchange/website/user/pricecontroller/" + 'getassistprice',
            success: function (res) {
              this.allPriceRate = res.datas;
              //var oriPrice = res.datas.prices[this.moneyType];
              /*if (res.datas.rate['USD_CNY']) {
                this.rate = res.datas.rate['USD_CNY'];
              }*/
              //this.oriPiece = oriPrice;
              //this.moneyPrice = oriPrice/this.rate;
              if(typeof callback == 'function'){
                callback();
              }
            }.bind(this)
          });
        },
        getAssets: function(userId) {
          Methods.ajax({
            type: 'GET',
            url: DOMAIN_MAIN + API_PREFIX + 'getAsset',
            success: function(res) {
              this.assets = res.datas;
            }.bind(this)
          });
        },
        // 获取用户资产信息
        getUserAssets: function(noCache) {
          var data = {
              noCache: noCache
          };
          // Methods.ajax({
          //   type: 'GET',
          //   url: DOMAIN_MAIN + API_PREFIX + 'getMainUserAsset',
          //   data: data,
          //   success: function(res) {
          //       this.loaded = true;
          //       //格式化数据，最多保留8位小数
          //       var result = res.datas.userFunds;
          //       if(result && result.length > 0){
          //           for(var i = 0, ilength = result.length; i < ilength; i++){
          //               for(var key in result[i]){
          //                   if(Methods.isNumber(result[i][key])){
          //                       result[i][key] = Methods.fixFloat(result[i][key], 8)
          //                   }
          //               }
          //           }
          //       }
          //       this.userAssets = result;
          //   }.bind(this)
          // });
        },
          getMainUserAssets: function(nocache) {
              var data = {
                  noCache: nocache
              };
              // Methods.ajax({
              //         type: 'GET',
              //         url: DOMAIN_MAIN + API_PREFIX + 'getMainUserAsset',
              //         data: data,
              //         success: function(res) {
              //
              //             var result = res.datas;
              //             this.mainUserAssets = result;
              //         }.bind(this)
              // });
          },
          editMainUserCoin: function(act, coin, userId) {
            var data = {
                fundtype: coin,
                childId: userId,
                isType: act
            };
              Methods.ajax({
                  type: 'GET',
                  url: DOMAIN_MAIN + API_PREFIX + 'doEditUserFund',
                  data: data,
                  success: function (res) {
                      this.getUserAssets(1);
                      $.toast({
                          heading: "<%= LANG('修改用户币种信息成功') %>",
                          text: EXX.L(res.resMsg.message),
                          showHideTransition: 'plain',
                          icon: 'success'
                      });
                  }.bind(this)
              });
          },
        getSubAccounts: function() {
          Methods.ajax({
            type: 'GET',
            url: DOMAIN_MAIN + API_PREFIX + 'getSubAccounts',
            success: function (res) {
              this.allSubAccounts = res.datas.accounts;
            }.bind(this)
          });
        },
        setCurrency: function(coin, userId) {
          var data = {
            assistCoin : coin.key,
            targetUserId: userId
          };
          if (!userId) {
            Methods.setCookie(ENV+'mname', coin.key);
            window.location.reload();
            return
          }

          Methods.ajax({
            type: 'GET',
            url: DOMAIN_MAIN + API_PREFIX + 'editAssistCoin',
            data: data,
            success: function (res) {
              //如果是主账户直接更新本地存储
              if (this.getUserInfo(userId).userType == 1) {
                var userInfo = this.loginUser;
                userInfo.assistCoin = coin.key;
                Methods.setLocalUserInfo(userInfo);
                this.loginUser = userInfo;
              }
              this.getUserAssets(1);

              this.showCurrencyList = false;
              $.toast({
                heading: "<%= LANG('辅助货币切换成功') %>",
                text: "<%= LANG('辅助货币已经更改为') %>" + coin.name.toUpperCase(),
                showHideTransition: 'plain',
                icon: 'success'
              });
//                Methods.setCookie(ENV+'mname', coin.name);
//                window.location.reload();
            }.bind(this)
          });
        },
        getUserInfo: function() {
          Methods.ajax({
            type: 'GET',
            url: DOMAIN_MAIN + API_PREFIX + 'getuserinfo',
            success: function (res) {
              //this.allSubAccounts = res.datas.accounts;
            }.bind(this)
          });
        },
        transfer: function(type, userId, coin) {
          this.transferInfo = {
            type: type,
            userId: userId,
            coin: coin
          };
          this.showModal = 'transfer';
        },
        transferSuccess: function() {
          return function() {
            JuaBox.info("<%= LANG('内部划账成功') %>");
            this.getUserAssets();
            this.showModal = false;
          }.bind(this)
        },
        userActionSuccess: function() {
          return function() {
            this.getUserAssets();
            this.closeModal('addAccount');
          }.bind(this)
        },
        setMobileSuccess: function() {
          return function() {
            this.closeModal('setMobile');
            JuaBox.info("<%= LANG('手机信息设置成功') %>");
          }.bind(this)
        },
          getWindowWidth: function() {
              if (!this.timer) {
                  this.timer = true;
                  var _this = this;
                  // 添加延迟处理
                  setTimeout(function () {
                      _this.timer = false
                      _this.winWidth = window.innerWidth;
                  }, 400);
              }
          },
        handleClickOutsideSelect: function() {
          this.showCurrencyList = false;
        }
      },
      created: function() {
        //this.getAssets();
        this.getAllMarketsInfo();
        this.getUserAssets();
        this.getPubKey();
        this.getPriceRate();
      },
      mounted: function() {
        //setInterval(this.getUserAssets, 5000);
        document.addEventListener('click', this.handleClickOutsideSelect, true);
          window.addEventListener('resize', this.getWindowWidth, true);
        $('[data-toggle="tooltip"]').tooltip();
      },
      updated: function() {
        $('[data-toggle="tooltip"]').tooltip();
      },
      beforeDestroy: function() {
        document.removeEventListener('click', this.handleClickOutsideSelect, true)
          document.removeEventListener('resize', this.getWindowWidth, true)
      }
    })
  });
</script>
<script type="text/javascript" src="<%= STATIC %>/scripts/slider.js"></script>
<script type="text/javascript" src="<%= STATIC %>/scripts/xulei-v1.js"></script>
