<script src="/lib/others/jquery.peity.js" charset="utf-8" ></script>
<link href="<%= STATIC %>/styles/u/asset.css?<%= VERSION %>" rel="stylesheet" type="text/css">

    <div id="user-index" :class="{'loading loading-light-bg' : !loaded}">
        <div class="account-panel" v-cloak="" v-if="loaded">
            <div class="user-group" :class="'user-type-' + loginUser.userType" >
                <div class="user-group-head" style="padding-bottom: 0">
                    <div class="user-info">
                        <div class="avatar">
                            <img v-if="loginUser.photo" :src="avatarBaseUrl + loginUser.photo" />
                            <img v-else :src="avatarBaseUrl + 'default.jpg'" />
                        </div>
                        <div class="info">
                            <h3>
                                <template v-if="loginUser.userType === 1">
                                    {{loginUser.nickName != '' ? loginUser.nickName : '<%= LANG('主账户') %>' }}
                                </template>
                                <template v-else>
                                    {{loginUser.nickName != '' ? loginUser.nickName : loginUser.userName}}
                                </template>
                            </h3>
                            <p>{{loginUser.loginName}} <a role="button" @click="editUser(loginUser.userId)"><%= LANG('编辑') %></a></p>

                        </div>
                    </div>
                    <div class="assets-info">
                        <div class="assets-num">
                            <%= LANG('账户资产价值') %>：
                            <p class="num">{{allTotalAsset}}</p>
                            <div class="coin-choice">
                                <a role="button">{{MONEY == 'none' ? '<%= LANG('默认')%>' : MONEY.toUpperCase()}}</a>
                                <ul >
                                    <li @click="setCurrency('usd')" :class="MONEY == 'usd' ? 'active' : ''">USD</li>
                                    <li @click="setCurrency('<%= UNIT %>')" :class="MONEY == '<%= UNIT %>' ? 'active' : ''"><%= LEGAL[UNIT].unit %></li>
                                </ul>
                            </div>
                        </div>
                        <div class="onffflist"><a role="button" @click="hideZero = !hideZero" :class="{'on' : hideZero}"><span><%= LANG('隐藏小额资产币种') %></span><i></i></a></div>
                    </div>
                </div>
                <div style="margin: 10px 10px 31px;display: flex;justify-content: flex-end">
                    <search-box v-model="keyWord"></search-box>
                </div>
                <div class="user-group-body">
                    <div class="vue-grid user-assets">
                            <div class="tr head">
                                <div class="td cointTag"><%= LANG('币种') %></div>
                                <div class="td total"><%= LANG('总额') %></div>
                                <!--<div class="td nettotoal"><%= LANG('净总额') %></div>-->
                                <div class="td useable"><%= LANG('可用') %></div>
                                <div class="td frozen"><%= LANG('冻结') %></div>
                                <!--<div class="td loan" v-if="loginUser.lever"><%= LANG('借入') %></div>-->
                                <div class="td last"><%= LANG('操作') %></div>
                            </div>
                            <div class="tr" v-for="(item,index) in filterUserCoinFunds(userCoinFunds)" v-if="(hideZero && parseFloat(getTotalPriceByAssist(item)) > 1) || !hideZero">
                                <div class="td cointTag">
                                    <img :src="'<%= STATIC %>/images/icon/market-icon/market-' + item.name.toLowerCase() + '.png?<%= VERSION%>'"/>
                                    <p>{{getRealCoinName(item.name).toUpperCase()}}</p>
                                    <span v-if='item.isLayerCoin' class="is-layer-coin"><%= LANG('法币') %></span>
                                </div>
                                <div class="td total">
                                        <span class="hint--top" :aria-label="showTotalAssistHint(item)">{{fixTotalDecimal(item,8)}}</span>
                                </div>
                                <!--<div class="td nettotoal">-->
                                        <!--<span class="hint&#45;&#45;top" :aria-label="'<%= LANG('折合') %>' + (currencySymbol(account.assistCoin) + showFixNumber(item.computeNetTotal))">{{showNumber(item.netTotal)}}</span>-->
                                <!--</div>-->
                                <div class="td useable green">
                                        <span class="hint--top" :aria-label="showAvailableAssistHint(item)">{{fixAvailableDecimal(item,8)}}</span>
                                </div>
                                <div class="td frozen red">
                                        <span class="hint--top" :aria-label="showFreezeAssistHint(item)">{{fixFreezeDecimal(item,8)}}</span>
                                </div>
                                <!--<div class="td loan" v-if="loginUser.lever">-->
                                        <!--<span class="hint&#45;&#45;top" :aria-label="'<%= LANG('折合') %>' + (currencySymbol(account.assistCoin) + showFixNumber(item.computeLoanIn))">{{showNumber(item.loanIn)}}</span>-->
                                        <!--<a v-if="Number(item.loanIn) > 0" @click="openRefund(account.userId, item.coin)"><%= LANG('还款') %></a>-->
                                <!--</div>-->
                                <div class="td last">
                                </div>

                                <div class="oper">
                                    <template v-if="loginUser.userType == 1">
                                        <!--判断能否充值,默认能充值-->
                                        <a v-if="item && item.isLayerCoin == 0" :href="'/u/payin/' + item.name" target="_self" class="f"><%= LANG('充值') %></a>
                                        <a v-else-if="item && item.isLayerCoin == 1" :href="'/u/payin/legaltender/' + item.name" target="_self" class="f"><%= LANG('充值') %></a>
                                        <a v-else onclick="JuaBox.info('Not open yet...')" class="f disabled"><%= LANG('充值') %></a>

                                        <a v-if="item.drawFlag == 1 && item.isLayerCoin == 0" :href="'/u/payout/' + item.name" target="_self"><%= LANG('提币') %></a>
                                        <a v-else-if="item.drawFlag == 1 && item.isLayerCoin == 1" :href="'/u/payout/legaltender/' + item.name" target="_self"><%= LANG('提币') %></a>
                                        <a v-else onclick="JuaBox.info('Not open yet...')" class="disabled"><%= LANG('提币') %></a>
                                    </template>
                                    <a :href="'/u/bill/' + item.name" target="_self"><%= LANG('账单') %></a>
                                </div>

                                <div class="act">
                                    <a v-if="index != 0" @click="topUserCoin(item.name, loginUser.userId)"><%= LANG('置顶') %></a>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>

        <modal  :open= "showModal == 'userAction'" @close="showModal = false">
            <user-action :params="userParams" :done="userActionSuccess()" />
        </modal>

        <modal  :open= "showModal == 'toggleUserAction'" @close="showModal = false">
            <toggle-user-action :params="userParams" :done="userActionSuccess()" />
        </modal>

        <modal  :open="showModal == 'setMobile'" @close="showModal = false">
            <set-mobile :done="setMobileSuccess()" />
        </modal>

        <modal  :open="showModal == 'payMobileAuth'" @close="showModal = false">
            <paymobile />
        </modal>

        <modal  :open="showModal == 'setGoogle'" @close="showModal = false">
            <set-google />
        </modal>

        <modal  :open="showModal == 'setEmail'"  @close="showModal = false">
            <set-email />
        </modal>

        <modal  :open="showModal == 'safepassword'" @close="showModal = false">
            <safepassword />
        </modal>

        <modal  :open= "showModal == 'addMarket'" @close="showModal = false">
            <add-market :params="marketParams" />
        </modal>

        <modal  :open="showModal == 'addCoin'"  @close="showModal = false">
            <add-coin :params="coinParams" />
        </modal>

        <modal  :open= "showModal == 'transfer'" @close="showModal = false">
            <transfer :info="transferInfo" :done="transferSuccess" />
        </modal>

        <modal  :open= "showModal == 'payin'" @close="showModal = false">
            <modal-payin :coin="payinCoin" :done="callCloseModal()" />
        </modal>

        <modal  :open= "showModal == 'payout'" @close="showModal = false">
            <modal-payout ref="payout" :coin="payoutCoin" />
        </modal>

        <modal  :open="showModal == 'bill'"  @close="showModal = false">
            <bill :params="billParams" theme="light" />
        </modal>

        <modal  :open= "showModal == 'refund'" @close="showModal = false">
            <modal-refund :params="refundParams" :user-asset="userAssets.getObject('userId', currentAccountId)" :done="callCloseModal()" />
        </modal>

        <modal  :open="showModal == 'safeset'"  @close="showModal = false">
            <safeset />
        </modal>

        <modal  :open="showModal == 'setloginpwd'"  @close="showModal = false">
            <setloginpwd />
        </modal>
    </div>




<%-include("../../component/search_box.html")%>
<%-include("../../component/json_grid.html")%>
<%-include("../../component/json_table.html")%>
<%-include("../../component/send_code.html")%>
<%-include("../../component/page_lite.html")%>
<%-include("../../component/modal.html")%>
<%-include("../../component/circular_progress.html")%>

<%-include("../model/userAction.html")%>
<%-include("../model/toggleUserAction.html")%>
<%-include("../model/setMobile.html")%>
<%-include("../model/payMobileAuth.html")%>
<%-include("../model/setgoogle.html")%>
<%-include("../model/email.html")%>
<%-include("../model/addcoin.html")%>
<%-include("../model/safePassword.html")%>
<%-include("../model/insideDebit.html")%>
<%-include("../model/payin.html")%>
<%-include("../model/payout.html")%>
<%-include("../model/bill.html")%>
<%-include("../model/refund.html")%>
<%-include("../model/safeset.html")%>
<%-include("../model/setLoginPwd.html")%>
<%-include("../../activity/_addMarket.html")%>



<script>
    $(function(){
        if( $('.mask span').text() <= 50 ){
            $('.circle_right').css('transform','rotate('+($('.mask span').text()*3.6)+'deg)');
        }else{
            $('.circle_right').css({
                'transform':'rotate(0deg)',
                "background":"#fba81c"
            });
            $('.circle_left').css('transform','rotate('+(($('.mask span').text()-50)*3.6)+'deg)');
        }
    })
</script>


<script>

    $(function(){
        $.fn.peity.defaults.bar = {
            delimiter: ",",
            fill: ["#414253"],
            height: 32,
            max: null,
            min: 0,
            padding: 0.1,
            width: 60
        };
        $(".linebar").peity("bar");
    });


    require(['vue', 'common/methods', 'common/juabox', 'components/country_code/index'], function(Vue, Methods, JuaBox) {

        //释放JuaBox到全局使用
        window.JuaBox = JuaBox;



        EXX.userIndex = new Vue({
            el: "#user-index",
            data: function () {
                return {
                    // isLogin : ISLOGIN,
                    loaded: false,
                    // pubKey: '',
                    timer: false,
                    hideZero : false,
                    showModal: false,
                    showAllAsset : false,
                    showCurrencyList: false,
                    mShowCoinDetail: false,
                    avatarBaseUrl: '<%= STATIC %>/images/userhead/',
                    repaymentAmount: '',
                    winWidth: window.innerWidth,
                    currentPriceType : MONEY,
                    userAssets: EXX.userNav.userAssets, //旧的逻辑是 用户头部基本信息和各种货币金额信息，现在改为金额不为零的货币的信息
                    mainUserAssets: [],
                    coinConfig : EXX.userNav.coinConfig,  //从顶部vue实例获取数据
                    assistPrice: {
                        'btc' : {
                            btc : 0,
                            ltc : 0,
                            eth : 0,
                            etc : 0
                        },
                    '<%= UNIT %>' : {
                            btc : 0,
                            ltc : 0,
                            eth : 0,
                            etc : 0
                        },
                        'usd' : {
                            btc : 0,
                            ltc : 0,
                            eth : 0,
                            etc : 0
                        }
                    },
                    loginUser: Methods.getLocalUserInfo(),
                    allSubAccounts: [],
                    safePwd: '',
                    dynamicCode: '',
                    googleCode: '',
                    payinCoin: '',
                    payoutCoin: '',
                    billParams: {},
                    refundParams: {},
                    coinParams: {},
                    userParams: {},
                    marketParams: {},
                    transferInfo: {},
                    editAccountInfo: {},
                    // allMarketsInfo: [],
                    // currencyList: [
                    //     {key: 'usd', name: 'USD', icon: 'icon-meiyuan', symbol: '$',decimal : 2},
                    //     {key: 'cny', name: 'CNY', icon: 'icon-cny', symbol: '¥',decimal : 2}
                    // ],
                    MONEY : MONEY == 'none' ? '<%= UNIT %>' : MONEY,

                    currentAccountId: (Methods.getCookie(ENV + 'currentAccountId') || Methods.getCookie(ENV + 'uid')),
                    keyWord:''
                }
            },
            computed: {
                /**
                 * 格式化用户资产数据
                 * 将金额不为0的货币与所有货币列表整合
                 */
                userCoinFunds: function() {
                    var coins = this.coinConfig || [];
                    var userAssets = this.userAssets;

                    var coinAssets = [];
                    coins.forEach(function (coin, index, array) {
                        var coinItem = coin;
                        userAssets.forEach(function (asset, idx, arr) {
                            if (coin.currencyId == asset.currencyTypeId) {
                                for (var k in asset) {
                                    coin[k] = asset[k];
                                }
                            }
                        });
                        coinAssets.push(coinItem);
                    }.bind(this));

                    return coinAssets;
                },
                //计算总资产金额
                allTotalAsset : function () {
                    var alltotal = 0;
                    var money = this.MONEY == 'none' ? 'btc' : this.MONEY;
                    var _this = this;

                    this.userCoinFunds.forEach(function (coin, index) {
                        var amount = coin.amount || 0;
                        alltotal += parseFloat( amount * _this.moneyPrice(money, coin.name) );
                    });
                    return Methods.fixNumber(alltotal, 3);
                },
                isMock : function () {
                    return this.currentUserInfo.userType == 3;
                }
            },
            watch: {
                showModal: function(value) {
                    // 添加class控制弹窗时不滚动主页内容
                    if (value) {
                        $('body').addClass('modal-open');
                    } else {
                        $('body').removeClass('modal-open');
                    }
                }
            },
            methods: {
                currencySymbol: function(currency) {
                    return this.currencyList.getObject('key', currency).symbol;
                },
                //搜索过滤
                filterUserCoinFunds:function(objs){
                    var _this = this;
                    if(!_this.keyWord){
                        return objs;
                    }
                    var nObj = [];
                    objs.forEach(function (coin, index) {
                        var coinName = coin.name;
                        if(coinName.toLowerCase().indexOf(_this.keyWord.toLowerCase()) != -1){
                            nObj.push(coin);
                        }
                    });

                    return nObj;
                },
                userHidedCoins: function(user) {
                    var fundMaps = user.coinFundMap;
                    var hidedCoins = [];
                    Object.keys(fundMaps).map(function(coin) {
                        var obj = fundMaps[coin];
                        if (!obj.showCoin) {
                            obj.coin = coin;
                            hidedCoins.push(fundMaps[coin]);
                        }
                    });
                    return hidedCoins;
                },
                showFixNumber : function (price){
                    return Methods.fixNumber(price, 3);
                },
                showNumber : function (val) {
                    return Methods.fixDecimal(val,8)
                },
                priceDisplay: function(num, money){
                    var moneyPrice = this.moneyPrice(money, 'btc');
                    return moneyPrice * Number(num);
                },
                resetCurrency: function(coin) {
                    return coin != '' && coin != 'none' ? coin : '<%= UNIT %>';
                },
                moneyPrice: function(money, coin){
                    var money = money || 'usd';
                    return Number(this.assistPrice[money] && this.assistPrice[money][coin] ? this.assistPrice[money][coin] : 1)
                },
                userEnabledCoin: function(user) {
                    var coinFundMap = user.coinFundMap;
                    var enabled = [];
                    Object.keys(coinFundMap).forEach(function(coin){
                        if (coinFundMap[coin].show) {
                            coinFundMap[coin]['name'] = coin;
                            enabled.push(coinFundMap[coin]);
                        }
                    });
                    return enabled;
                },
                openModal: function(name) {
                    if (name == 'setMobile' && this.loginUser.emailAuth == 0) {
                        JuaBox.info("<%= LANG('需要先认证邮箱才能修改手机号码。')%>")
                        this.showModal = false;
                        return
                    }
                    this.showModal = name;
                    //this.$refs[name].open = true;
                },
                callCloseModal: function() {
                    return function() {
                        this.showModal = false;
                    }.bind(this)
                },
                closeModal: function() {
                    this.showModal = false;
                },
                linkToMarket: function(account) {
                    // Methods.setCookie(ENV+'currentAccountId', account.userId);
                    window.location.replace('/trade');
                },
                openCurrencyList: function(id) {
                    this.showCurrencyList = id;
                },
                openPayin: function(coin) {
                    this.showModal = 'payin';
                    this.payinCoin = coin;
                },
                openPayout: function(coin) {
                    this.showModal = 'payout';
                    this.payoutCoin = coin;
                },
                openBill: function(userId, coin) {
                    this.billParams = {
                        userId: userId,
                        coin: coin
                    };
                    this.showModal = 'bill';
                },
                openRefund: function(userId, coin) {
                    this.refundParams = {
                        userId: userId,
                        coin: coin
                    };
                    this.showModal = 'refund';
                },
                openAddMarket: function(account) {
                    this.showModal = 'addMarket';
                    this.showMainHide = false;
                    this.marketParams = {
                        account: account
                    }
                },
                setEmail: function() {
                    if (this.loginUser.emailAuth == 1) {
                        return
                    }
                    this.showModal = 'setEmail';
                },
                editUser: function(userId) {
                    this.userParams = {
                        optType: 3,
                        userId: userId,
                        account: this.loginUser
                    };
                    this.showModal = 'userAction';
                },
                //获取指定辅助货币的总价格-ok
                getTotalPriceByAssist: function (coin) {
                    if(!coin || !this.assistPrice){
                        return ''
                    }
                    var assistCoin = this.MONEY;
                    var amount = coin.amount || 0;
                    if (assistCoin == 'none' || assistCoin == '') {
                        return Methods.fixNumber(amount, 4);
                    } else {
                        return Methods.fixNumber(parseFloat(amount) * parseFloat(this.assistPrice[assistCoin][coin.name]), 4) || '--';
                    }
                },
                //获取指定辅助货币折算的价格-ok price-要折算的价格
                getConvertPriceByAssist: function (coin, price) {
                    if(!coin || !this.assistPrice){
                        return ''
                    }
                    var assistCoin = this.MONEY;
                    if (assistCoin == 'none' || assistCoin == '') {
                        return Methods.fixNumber(price, 4);
                    } else {
                        return Methods.fixNumber(parseFloat(price) * parseFloat(this.assistPrice[assistCoin][coin.name.toLowerCase()]), 4) || '--';
                    }
                },
                //获取当前货币单位
                showAssistCoin : function () {
                    //显示辅助货币名字，不显示默认
                    if(this.MONEY == 'none'){
                        return '';
                    }else{
                        return this.MONEY.toUpperCase();
                    }
                },
                //总金额
                showTotalAssistHint: function (coin) {
                    var price = this.fixAvailableDecimal(coin, 8);
                    return "<%= LANG('折合')%>:" + this.getConvertPriceByAssist(coin, price) + " " + this.showAssistCoin();
                },
                //可用价格折合的提示内容
                showAvailableAssistHint : function (coin) {
                    var price = this.fixAvailableDecimal(coin, 8);
                    return "<%= LANG('折合')%>:" + this.getConvertPriceByAssist(coin, price) + " " + this.showAssistCoin();
                },
                //冻结价格折合的提示内容
                showFreezeAssistHint : function (coin) {
                    var price = this.fixFreezeDecimal(coin, 8);
                    return "<%= LANG('折合')%>:" + this.getConvertPriceByAssist(coin, price) + " " + this.showAssistCoin();
                },
                fixFloat : function (value,unit) {
                    return Methods.fixFloat(value, unit);
                },
                fixNumber : function (value,unit) {
                    return Methods.fixNumber(value, unit);
                },
                //总资金
                fixTotalDecimal: function (coin, unit) {
                    var amount = parseFloat(coin.amount || 0);
                    var freeze = parseFloat(coin.freeze || 0);
                    // console.log(freeze);

                    return Methods.fixDecimal(amount + freeze, unit);
                },
                //可用资金
                fixAvailableDecimal : function (coin, unit) {
                    var amount = coin.amount || 0;
                    var value = parseFloat(amount);
                    // var freeze = coin.freeze || 0;
                    // var value = parseFloat(amount - freeze);

                    return Methods.fixDecimal(value, unit);
                },
                //冻结资金
                fixFreezeDecimal : function (coin, unit) {
                    var freeze = parseFloat(coin.freeze || 0);

                    return Methods.fixDecimal(freeze, unit);
                },
                //去掉虚拟市场货币的D字符
                getRealCoinName : function (coin) {
                    if(coin.length > 3 && coin.substring(0,1) == 'd'){
                        return coin.substring(1);
                    }else{
                        return coin;
                    }
                },
                // 获取币价汇率
                getPriceRate: function(callback) {
                    Methods.ajax({
                        url: DOMAIN_DEV + "/exchange/config/controller/website/pricecontroller/" + 'getassistprice',
                        success: function (res) {
                            this.loaded = true;

                            this.assistPrice = res.datas;
                            //var oriPrice = res.datas.prices[this.moneyType];
                            /*if (res.datas.rate['USD_CNY']) {
                              this.rate = res.datas.rate['USD_CNY'];
                            }*/
                            //this.oriPiece = oriPrice;
                            //this.moneyPrice = oriPrice/this.rate;
                            if(typeof callback == 'function'){
                                callback();
                            }
                        }.bind(this),
                        error : function(){
                        }
                    });
                },
                /*
                * 获取所有货币信息
                * */
                getCoinConfig: function() {
                    var data = {
                        // webId: 100
                    };
                    Methods.ajax({
                        type: 'GET',
                        //url: DOMAIN_MAIN + API_PREFIX + 'getCoinMaps',
                        data: data,
                        url: DOMAIN_DEV + "/exchange/config/controller/website/currencycontroller/" + 'getCurrencyList',
                        success: function(res) {
                            this.coinConfig = res.datas;
                        }.bind(this)
                    });
                },
                // 获取用户总额不为零的货币信息(财务中心)
                getAccountAssets: function () {
                    var data = {
                        // webId: 100,
                        userId: Methods.getLocalUserInfo(ENV + 'userInfo').userId,
                        pageSize: 9999,
                        pageNum: 1
                    };
                    Methods.ajax({
                        url: DOMAIN_DEV + "/exchange/fund/controller/website/fundcontroller/" + 'findbypage',
                        data: JSON.stringify(data),
                        success: function(res) {
                            if(res.datas.list){
                                this.userAssets = res.datas.list;
                            }
                        }.bind(this)
                    });
                },
                //置顶货币 接口暂无
                topUserCoin: function(coin, userId) {
                    var data = {
                        coin: coin,
                        targetUserId: userId
                    };
                    // Methods.ajax({
                    //     type: 'GET',
                    //     url: DOMAIN_MAIN + API_PREFIX + 'topUserCoin',
                    //     data: data,
                    //     success: function (res) {
                    //         this.getAccountAssets(1);
                    //         $.toast({
                    //             heading: "<%= LANG('修改用户币种信息成功') %>",
                    //             text: EXX.L(res.resMsg.message),
                    //             showHideTransition: 'plain',
                    //             icon: 'success'
                    //         });
                    //     }.bind(this)
                    // });
                },
                getSubAccounts: function() {
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_MAIN + API_PREFIX + 'getSubAccounts',
                        success: function (res) {
                            this.allSubAccounts = res.datas.accounts;
                        }.bind(this)
                    });
                },
                // 设置辅助币种
                setCurrency: function(coin) {
                    if (!this.isLogin) {
                        Methods.setCookie(ENV+'mname', coin);
                        this.MONEY = coin;
                        return
                    }

                    var data = {
                        assistCoin : coin
                    };
                    Methods.ajax({
                        // url: DOMAIN_MAIN + API_PREFIX + 'editAssistCoin',
                        url: DOMAIN_DEV+ "/exchange/user/controller/website/usercontroller/" + 'editassistcoin',
                        data: JSON.stringify(data),
                        success: function (res) {
                            Methods.setCookie(ENV+'mname', coin);
                            this.MONEY = coin;
                            //top.location.reload();
                        }.bind(this)
                    });
                },
                getUserInfo: function() {
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_MAIN + API_PREFIX + 'getuserinfo',
                        success: function (res) {
                            //this.allSubAccounts = res.datas.accounts;
                        }.bind(this)
                    });
                },
                transfer: function(type, userId, coin) {
                    this.transferInfo = {
                        type: type,
                        userId: userId,
                        coin: coin
                    };
                    this.showModal = 'transfer';
                },
                transferSuccess: function() {
                    this.getAccountAssets();
                    this.showModal = false;
                },
                userActionSuccess: function() {
                    return function() {
                        this.getAccountAssets();
                        this.closeModal('addAccount');
                    }.bind(this)
                },
                setMobileSuccess: function() {
                    return function() {
                        this.closeModal('setMobile');
                        JuaBox.info("<%= LANG('手机信息设置成功') %>");
                    }.bind(this)
                },
                getWindowWidth: function() {
                    if (!this.timer) {
                        this.timer = true;
                        var _this = this;
                        // 添加延迟处理
                        setTimeout(function () {
                            _this.timer = false
                            _this.winWidth = window.innerWidth;
                        }, 400);
                    }
                },
                handleClickOutsideSelect: function() {
                    this.showCurrencyList = false;
                }
            },
            created: function() {
                //获取用户资金
                this.getAccountAssets();
                //获取货币信息
                this.getCoinConfig();

                this.getPriceRate();
            },
            mounted: function() {
                document.addEventListener('click', this.handleClickOutsideSelect, true);
                window.addEventListener('resize', this.getWindowWidth, true);
                $('[data-toggle="tooltip"]').tooltip();
            },
            updated: function() {
                $('[data-toggle="tooltip"]').tooltip();
            },
            beforeDestroy: function() {
                document.removeEventListener('click', this.handleClickOutsideSelect, true)
                document.removeEventListener('resize', this.getWindowWidth, true)
            }
        })
    });
</script>
<script type="text/javascript" src="<%= STATIC %>/scripts/slider.js"></script>
<script type="text/javascript" src="<%= STATIC %>/scripts/xulei-v1.js"></script>
