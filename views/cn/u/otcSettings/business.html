<div class="business" id="business">
    <div class="status" v-if="!applyPage" v-cloak="">
        <div class="general-business">
            <div class="title">
                <img src="<%= IMG_STATIC %>/images/general-business.png" alt="">
                <span><%=LANG('普通商家')%></span>
                <img src="<%= IMG_STATIC %>/images/complete.png" alt="">
            </div>
            <P><%=LANG('当前已是普通商家，拥有发广告的权限，交易单笔不能超过2000CNY，总交易额不能超过50000CNY，申请认证商家可拥有更高交易额度！')%></P>
        </div>
        <div class="senior-business">
            <div class="title">
                <img src="<%= IMG_STATIC %>/images/senior-business.png" alt="">
                <span><%=LANG('认证商家')%></span>
                <button v-if="bussineseStatus.otcLevel == 0" @click="apply"><%=LANG('立即申请')%></button>
                <img v-else src="<%= IMG_STATIC %>/images/complete.png" alt="">
            </div>
            <p><%=LANG('认证商家可拥有排名优先，大额交易的权限！')%></p>
        </div>
    </div>
    <div class="apply" v-else v-cloak="">
        <h2><%=LANG('OTC认证商家申请')%></h2>
        <h4><%=LANG('步骤一：准备资料')%></h4>
        <p><%=LANG('1.请下载')%><span><a href=""><%=LANG('《商家申请资料模板》')%></a></span>,<%=LANG('按照要求填写申请资料。')%></p>
        <p><%=LANG('2.录制视频资料，要求如下：')%></p>
        <p><%=LANG('手持本人身份证正面进行录制，保持录制过程中声音和影像都清晰。')%></p>
        <p><%=LANG('录制时要求诵读：本人（姓名），身份证号（身份证号码），我的资金来源合法可靠，自愿交易比特币等数字资产，本人充分了解数字货币及潜在风险，本人具有抗风险的能力并愿意承担一切风险。')%></p>
        <h4><%=LANG('步骤二：发送申请邮件')%></h4>
        <p><%=LANG('请将以上申请资料和视频资料发送邮件至otc@xt.com，邮件主题为“申请成为OTC商家”。')%></p>
        <h4><%=LANG('步骤三：提交申请')%></h4>
        <p><%=LANG('发送邮件后，请在页面点击“确认申请”按钮，提交申请并同意冻结50,000 XT作为商家保证金。')%></p>
        <h4><%=LANG('步骤四：资料审核')%></h4>
        <p><%=LANG('我们将在3个工作日内对您的商家申请资料进行审核。我们会主动与您取得联系，请保持通讯畅通。')%></p>
        <div class="xieyi"><%=LANG('请您务必仔细阅读并透彻理解')%><span><%=LANG('《OTC服务协议》')%></span></div>
        <div class="radio">
            <input type="checkbox" v-model="checkAgreement" @click="changeAgreement">
            <p><%=LANG('我已阅读并同意以上说明及协议，并冻结XT保证金')%></p>
        </div>
        <div class="btn">
            <button @click="applySubmit"><%=LANG('立即申请成为认证商家')%></button>
        </div>
    </div>
</div>

<script>
    require(['vue', 'common/methods', 'common/juabox'], function (Vue, Methods, JuaBox) {
        var business = new Vue({
            el: "#business",
            data: function () {
                return {
                    applyPage: false,
                    bussineseStatus: {},
                    checkAgreement: false,
                    currencyAmount: null
                }
            },
            created() {
                this.queryBussinese()
                this.getCurrencyAmount()
            },
            computed: {

            },
            methods: {
                changeAgreement: function() {
                    this.checkAgreement = !this.checkAgreement
                },
                apply: function() {
                    this.applyPage = true
                },
                applySubmit: function() {
                    console.log(this.checkAgreement)
                    var data = {
                        currencyName: 'xt',
                        currencyAmount: '0.1'  //this.currencyAmount  上线前需要改成接口获取
                    }
                    if (this.checkAgreement) {
                        Methods.ajax({
                            type: 'POST',
                            url: DOMAIN_DEV +
                                '/exchange/XtOtcController/attestMerchant',
                            data: data,
                            success: function (res) {
                                this.bussineseStatus = res.datas
                                JuaBox.success(EXX.L(res.resMsg.code));
                                this.queryBussinese()
                                this.applyPage = false
                            }.bind(this),
                            error: function (res) {
                                JuaBox.success(EXX.L(res.resMsg.message));
                            }
                        })
                    } else {
                        JuaBox.info("<%=LANG('请勾选协议')%>");
                    }
                },
                getCurrencyAmount: function() {
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_DEV +
                            '/exchange/XtOtcController/selectConfigSetting',
                        data: {},
                        success: function (res) {
                            this.currencyAmount = res.datas
                        }.bind(this)
                    })
                },
                queryBussinese: function () {
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_DEV +
                            '/exchange/XtOtcController/queryMerchant',
                        data: {},
                        success: function (res) {
                            this.bussineseStatus = res.datas
                        }.bind(this)
                    })
                }
            }
        })
    });
</script>