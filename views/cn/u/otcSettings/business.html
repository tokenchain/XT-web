<div class="business" id="business">
    <div v-if="loading" class="cd-loading">
        <div class="vertical-bars">
            <p class="layer-1"></p>
            <p class="layer-2"></p>
            <p class="layer-3"></p>
            <p class="layer-4"></p>
            <p class="layer-5"></p>
            <p class="layer-6"></p>
            <p class="layer-7"></p>
            <p class="layer-8"></p>
            <p class="layer-9"></p>
        </div>
    </div>
    <div class="status" v-if="!loading && !applyPage" v-cloak="">
        <div class="general-business">
            <div class="title">
                <img src="<%= IMG_STATIC %>/images/general-business.png" alt="">
                <span><%=LANG('普通商家')%></span>
                <img v-if="bussineseStatus"
                     src="<%= IMG_STATIC %>/images/complete.png" alt="">
                <a v-if="!bussineseStatus" style="color: #FFBE3F" href="/u/certify"><%=LANG('去高级实名认证')%></a>
            </div>
            <P v-if="bussineseStatus && bussineseStatus.otcLevel == 0 && bussineseStatus.status ==1">
                <%=LANG('当前已是普通商家，拥有发广告的权限，交易单笔不能超过')%>{{config.merchantSingleMax}}CNY
                <%=LANG('总交易额不能超过')%>{{config.merchantOnedayMax}}CNY
                <%=LANG('申请认证商家可拥有更高交易额度！')%>
            </P>
        </div>
        <div class="senior-business">
            <!--otcLevel  0未商家认证  1已商家认证-->
            <!-- -3解除审核拒绝 -2解除审核成功 -1解除审核中 0申请认证中 1已申请认证成功 2申请认证拒绝-->
            <div class="title">
                <img src="<%= IMG_STATIC %>/images/senior-business.png" alt="">
                <span><%=LANG('认证商家')%></span>
                <button v-if="bussineseStatus && bussineseStatus.otcLevel == 0" @click="apply">
                    <%=LANG('立即申请')%>
                </button>
                <img v-if="bussineseStatus && bussineseStatus.otcLevel == 1"
                     src="<%= IMG_STATIC %>/images/complete.png" alt="">
                <button v-if="bussineseStatus && bussineseStatus.otcLevel == 1" @click="removeMerchant"><%=LANG('解除认证')%></button>
                <p v-if="bussineseStatus && bussineseStatus.status == 0"><%=LANG('申请认证中')%></p>
                <p v-if="bussineseStatus && bussineseStatus.status == -1"><%=LANG('解除审核中')%></p>
                <!--<p v-if="bussineseStatus && bussineseStatus.status == -2"><%=LANG('解除审核成功')%></p>-->
                <p v-if="bussineseStatus && bussineseStatus.status == -3"><%=LANG('解除审核拒绝,原因：')%>{{bussineseStatus.remark}}</p>
            </div>
            <p><%=LANG('认证商家可拥有排名优先，大额交易的权限！')%></p>
        </div>
    </div>
    <div class="apply" v-if="!loading && applyPage" v-cloak="">
        <h2><%=LANG('OTC认证商家申请')%></h2>
        <h4><%=LANG('步骤一：准备资料')%></h4>
        <p><%=LANG('1.请下载')%><span><a href="http://oss-xt.oss-cn-hongkong.aliyuncs.com/doc/3d88e57e-ec5a-40a2-bad7-ccba427b22ec.docx"><%=LANG('《商家申请资料模板》')%></a></span>,<%=LANG('按照要求填写申请资料。')%></p>
        <p><%=LANG('2.录制视频资料，要求如下：')%></p>
        <p><%=LANG('手持本人身份证正面进行录制，保持录制过程中声音和影像都清晰。')%></p>
        <p><%=LANG('录制时要求诵读：本人（姓名），身份证号（身份证号码），我的资金来源合法可靠，自愿交易比特币等数字资产，本人充分了解数字货币及潜在风险，本人具有抗风险的能力并愿意承担一切风险。')%></p>
        <h4><%=LANG('步骤二：发送申请邮件')%></h4>
        <p><%=LANG('请将以上申请资料和视频资料发送邮件至otc@xt.com，邮件主题为“申请成为OTC商家”。')%></p>
        <h4><%=LANG('步骤三：提交申请')%></h4>
        <p><%=LANG('发送邮件后，请在页面点击“确认申请”按钮，提交申请并同意冻结50,000 XT作为商家保证金。')%></p>
        <h4><%=LANG('步骤四：资料审核')%></h4>
        <p><%=LANG('我们将在3个工作日内对您的商家申请资料进行审核。我们会主动与您取得联系，请保持通讯畅通。')%></p>
        <div class="xieyi"><%=LANG('请您务必仔细阅读并透彻理解')%><a style="color: #FFBE3F;" href="/help/OTCagreement"><%=LANG('《OTC服务协议》')%></a></div>
        <div class="radio">
            <input type="checkbox" :value="1" v-model="checkAgreement">
            <p><%=LANG('我已阅读并同意以上说明及协议，并冻结XT保证金')%></p>
        </div>
        <div class="btn">
            <button @click="applySubmit"><%=LANG('立即申请成为认证商家')%></button>
        </div>
    </div>
</div>

<script>
    require(['vue', 'common/methods', 'common/juabox'], function (Vue, Methods, JuaBox) {
        var business = new Vue({
            el: "#business",
            data: function () {
                return {
                    loading: true,
                    applyPage: false,
                    bussineseStatus: {
                        otcLevel: '',
                        status: ''
                    },
                    checkAgreement: [],
                    currencyAmount: null,
                    config: {},
                    loginUser: Methods.getLocalUserInfo(ENV + 'userInfo')
                }
            },
            created() {
                this.queryBussinese()
                this.getCurrencyAmount()
                this.getConfig()
                if (this.loginUser.safePwdAuth == '0') {
                    JuaBox.confirm("<%=LANG('您还未设置交易密码！')%>", {
                        buttons: {confirm: "去设置"}, callback: function () {
                            window.location.href = 'account'
                        }
                    })
                }
            },
            computed: {},
            methods: {
                removeMerchant: function () {   //解除审核
                    JuaBox.confirm("<%=LANG('确定解除认证商家吗？解除认证商家审核通过后，您将不再拥有认证商家的所有权限。')%>", function () {
                        Methods.ajax({
                            type: 'GET',
                            url: DOMAIN_DEV +
                                '/exchange/XtOtcController/removeVipMerchant',
                            data: {
                                userId: this.loginUser.userId
                            },
                            success: function (res) {
                                console.log(res.datas)
                                JuaBox.success(EXX.L(res.resMsg.code));
                                this.queryBussinese()
                            }.bind(this),
                            error: function (res) {
                                JuaBox.wrong(EXX.L(res.resMsg.code));
                            }
                        })
                    }.bind(this))
                },
                apply: function () {
                    if (this.bussineseStatus.status == 0 || this.bussineseStatus.status == -1) {
                        JuaBox.info("<%=LANG('后台正在审核中，请耐心等待！')%>")
                        return
                    }
                    this.applyPage = true
                },
                applySubmit: function () {
                    if (this.loginUser.safePwdAuth == '0') {
                        JuaBox.confirm("<%=LANG('您还未设置交易密码！')%>", {
                            buttons: {confirm: "去设置"}, callback: function () {
                                window.location.href = 'account'
                            }
                        })
                        return false
                    }
                    if (this.bussineseStatus == null) {
                        JuaBox.confirm("<%=LANG('您还未高级实名认证！')%>", {
                            buttons: {confirm: "去认证"},
                            callback: function () {
                                window.location.href = 'account'
                            }
                        })
                        return false
                    }
                    // console.log(this.checkAgreement)
                    var data = {
                        currencyName: 'xt',
                        currencyAmount: this.currencyAmount  //this.currencyAmount  上线前需要改成接口获取
                    }
                    if (this.checkAgreement.length > 0) {
                        Methods.ajax({
                            type: 'POST',
                            url: DOMAIN_DEV +
                                '/exchange/XtOtcController/attestMerchant',
                            data: data,
                            success: function (res) {
                                this.bussineseStatus = res.datas
                                JuaBox.success(EXX.L(res.resMsg.code));
                                this.queryBussinese()
                                this.applyPage = false
                            }.bind(this),
                            error: function (res) {
                                JuaBox.wrong(EXX.L(res.resMsg.code));
                            }
                        })
                    } else {
                        JuaBox.info("<%=LANG('请勾选协议')%>");
                    }
                },
                getCurrencyAmount: function () {
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_DEV +
                            '/exchange/XtOtcController/selectConfigSetting',
                        data: {},
                        success: function (res) {
                            this.currencyAmount = res.datas
                        }.bind(this)
                    })
                },
                getConfig: function () {  //获取配置
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_DEV +
                            '/exchange/admin/OtcController/selectOTCConfig',
                        data: {},
                        success: function (res) {
                            this.config = res.datas
                        }.bind(this)
                    })
                },
                queryBussinese: function () {
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_DEV +
                            '/exchange/XtOtcController/queryMerchant',
                        data: {},
                        success: function (res) {
                            this.bussineseStatus = res.datas
                            if (res.datas == null) {
                                JuaBox.confirm("<%=LANG('您还未高级实名认证！')%>", {
                                    buttons: {confirm: "去认证"}, callback: function () {
                                        window.location.href = 'account'
                                    }
                                })
                            }
                            this.loading = false
                        }.bind(this)
                    })
                }
            }
        })
    });
</script>