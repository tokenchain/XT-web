<%-include("../../component/page_lite.html")%>

<div class="partner-container" id="partnerBox" v-cloak>
    <div class="partner-details">
        <p>
            <%= LANG('合伙人详情') %>
        </p>
        <div class="pieChart clearfix">
            <ul>
                <li>
                    <span>
                        <%= LANG('总邀请用户') %></span>
                    <em>{{userCount}}
                        <%= LANG('人') %></em>
                </li>
                <li>
                    <span>
                        <%= LANG('有效用户') %></span>
                    <em>{{userEffectiveAcount}}
                        <%= LANG('人') %></em>
                </li>
                <li>
                    <span>
                        <%= LANG('我的总收益') %></span>
                    <em>{{totalProfit | numFilter}}XT</em>
                </li>
                <li>
                    <span>
                        <%= LANG('本月收益') %></span>
                    <em>{{monthProfit | numFilter}}
                        <%= LANG('XT') %></em>
                </li>
            </ul>
        </div>
    </div>
    <div class="share-info">
        <p>
            <%= LANG('分享方式') %>
        </p>
        <div class="info">
            <div class="code">
                <span>
                    <%= LANG('邀请二维码') %></span>
                <canvas class="codeimg" id="canvas" style="margin-top: 20px;"></canvas>
            </div>
            <div class="copyUrl-info">
                <span>
                    <%= LANG('邀请链接地址') %></span>
                <textarea rows="2" :value="reommendUrl" id="commendInput" readonly="readonly"></textarea>
                <a class="copyBtn" href="javascript:void(0)" @click="copyUrl(1)">
                    <%= LANG('复制') %> </a>
            </div>
            <div class="invite-info">
                <span>
                    <%= LANG('邀请码') %></span>
                <textarea rows="2" :value="recommendCode" id="recommendCode" readonly="readonly"></textarea>
                <a class="copyBtn" href="javascript:void(0)" @click="copyUrl(2)">
                    <%= LANG('复制') %> </a>
            </div>
        </div>
    </div>
    <div class="earnings">
        <p class="">
            <%= LANG('收益比例列表') %>
        </p>
        <table>
            <thead>
                <tr>
                    <th>
                        <%= LANG('合伙人等级') %>
                    </th>
                    <th>
                        <%= LANG('有效用户数') %>
                    </th>
                    <th style="width: 260px;">
                        <%= LANG('月最低交易额（BTC）') %>
                    </th>
                    <th>
                        <%= LANG('交易手续费折扣') %>
                    </th>
                    <th>
                        <%= LANG('返佣比例') %>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="(item, index) in earningsList" :key="index">
                    <td style="position: relative">P{{item.vipLevel}}<span class="vipLevel">{{item.vipLevel == loginUser.vipLevel ? '<%= LANG('当前等级') %>' : ''}}</span></td>
                    <td v-if="item.vipLevel == '6'"> {{item.usersCountMin + '+'}}</td>
                    <td v-else>{{item.usersCountMax ? item.usersCountMin + '-' + item.usersCountMax : 0}}</td>
                    <td v-if="item.vipLevel == '6'"> {{item.tradingAmountMin}}</td>
                    <td v-else>{{item.tradingAmountMin | numFilter}}</td>
                    <td>{{item.feeDiscount > 0 ? item.feeDiscount * 10 + '<%= LANG('折') %>' : '<%= LANG('免费') %>'}}</td>
                    <td>{{item.cashBack > 0 ? (item.cashBack * 100 + '%') : 0}}</td>
                </tr>
            </tbody>
        </table>
        <div class="describe">
            <h2>
                <%= LANG('合伙人说明') %>
            </h2>
            <ul>
                <li>1、
                    <%= LANG('合伙人等级评定：有效用户数或者月交易额两个指标按达到的最低等级为准，如：有效用户数达到P5级，月交易额达到P3级，那么合伙人等级则为P3；') %>
                </li>
                <li>2、
                    <%= LANG('有效用户是指个人下级用户（仅限与自己直接相关的用户）完成高级实名认证并且充值大于50USDT等值的数字资产，且至少有一次交易记录；') %>
                </li>
                <li>3、
                    <%= LANG('30天内累计交易额是指包括自己交易和邀请的下级用户交易换算成等值的BTC;') %>
                </li>
                <li>4、
                    <%= LANG('交易手续费用优惠，指用户本身的交易行为优惠(不包含下级)。比如币种的交易费用为0.08%(具体以平台后台设定为准)，在此基础上进行折扣优惠。') %>
                </li>
                <li>5、
                    <%= LANG('返拥比例，指的是名下推荐的有效用户的交易产生的手续费按照该比例用获得返拥。') %>
                </li>
            </ul>
            <p>
                <%= LANG('本活动最终解释权归XT所有。') %>
            </p>
        </div>
    </div>
</div>

<script>
    require(['vue', 'common/methods', 'common/juabox', 'clipboadrd', 'qrcode'], function (Vue, Methods, JuaBox,
        Clipboard, QRCode) {
        var recommend = new Vue({
            el: "#partnerBox",
            data: function () {
                return {
                    reommendUrl: location.protocol + '//' + location.host + '/r/' + (Methods.getLocalUserInfo()
                        .recommendCode || ''),
                    isLogin: ISLOGIN,
                    loginUser: Methods.getLocalUserInfo(ENV + 'userInfo'), //用户信息
                    recommendCode: Methods.getLocalUserInfo().recommendCode || '', // 邀请码
                    userEffectiveAcount: '', //有效用户数
                    userCount: '', // 注册人数
                    totalProfit: '', // 总收益
                    monthProfit: '', // 昨日收益
                    earningsList: [] // 收益比例列表
                }
            },
            created() {
                this.$nextTick(function () {
                    this.getDetailsData()
                    this.getEarningsData()
                })
            },
            mounted: function () {
                QRCode.toCanvas(document.getElementById('canvas'), this.reommendUrl, {
                    width: 150,
                    height: 150
                }, function (error) {})
            },
            filters: {
              numFilter(value) {
                var realVal = parseFloat(Number(value).toFixed(6))
                return realVal
              }
            },
            methods: {
                getDetailsData() {
                    if (!this.isLogin) {
                        return false;
                    }
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_DEV +
                            '/exchange/xt/controller/website/PartnerController/getPartnerInfo',
                        data: {
                            userId: this.loginUser.userId
                        },
                        success: function (res) {
                            this.userCount = res.datas.userCount
                            this.userEffectiveAcount = res.datas.userEffectiveAcount
                            this.totalProfit = res.datas.totalProfit
                            this.monthProfit = res.datas.monthProfit
                        }.bind(this)
                    });
                },
                getEarningsData() {
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_DEV +
                            '/exchange/xt/controller/website/PartnerController/profitConfig',
                        success: function (res) {
                            this.earningsList = res.datas
                        }.bind(this)
                    })
                },
                copyUrl: function (type) {
                    if (type == 1) {
                        var Url = document.getElementById("commendInput");
                        Url.select(); // 选择对象
                        document.execCommand("Copy"); // 执行浏览器复制命令
                        JuaBox.success("<%= LANG('复制邀请链接地址成功!') %>");
                    } else if (type == 2) {
                        var Url = document.getElementById("recommendCode");
                        Url.select();
                        document.execCommand("Copy");
                        JuaBox.success("<%= LANG('复制成功!') %>");
                    }
                }
            }
        })
    });
</script>