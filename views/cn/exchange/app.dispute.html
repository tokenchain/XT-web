<script>
    require(['vue', 'common/methods'], function(Vue, Methods) {
        new Vue({
            el: "#app-dispute",
            data: function() {
                return {
                    loaded:false,
                    locked:false,
                    orderId : Methods.getUrlparm('id') || '',
                    showModal:false,
                    currBigImg:'',
                    pageSize:5,
                    pageIndex:1,
                    orderInfo:'',
                    appealInfo:'',
                    appealReason:{
                        '1':"<%= LANG('对方无应答') %>",
                        '2':"<%= LANG('对方未放行') %>",
                        '3':"<%= LANG('对方未付款') %>",
                        '4':"<%= LANG('对方有欺诈行为') %>",
                        '5':"<%= LANG('其他') %>",
                    },
                    orderStatus:{
                        '0':"<%= LANG('接单中') %>",
                        '1':"<%= LANG('交易中') %>",
                        '2':"<%= LANG('交易成功') %>",
                        '3':"<%= LANG('订单确认') %>",
                        '4':"<%= LANG('申诉中') %>",
                        '5':"<%= LANG('接单超时') %>",
                        '6':"<%= LANG('支付超时') %>",
                        '7':"<%= LANG('确认超时') %>",
                        '8':"<%= LANG('订单取消') %>",
                        '9':"<%= LANG('申诉失败') %>",
                        '10':"<%= LANG('申诉成功') %>",
                    }
                }
            },
            methods: {
                getCoinName : function (market) {
                    return !market ? '' :  market.split('_')[0].toUpperCase();
                },
                getMoneyName : function (market) {
                    return !market ? '' :  market.split('_')[1].toUpperCase();
                },
                openChat: function(groupkey) {
//                    EXX.chatPlugin.toggle(true);
                    EXX.chatPlugin.outSideGroupChat(groupkey);
                },
                refreshAppealInfo:function(){
                    this.getAppealInfo();
                    this.showModal = false;
                },
                getStrImgArr:function(val){
                    if(!val){
                        return;
                    }
                    return val.split(',')
                },
                getStrTime:function(val){
                    if(!val){
                        return '--:--:--';;
                    }
                    return Methods.getDateTime(val,'YYYY-MM-DD HH:MM:SS')
                },
                getFullImgName:function(val){
                    if(!val){
                        return;
                    }
                    return DOMAIN_FILE + "/picauth?file=" + val + '&type=1';
                },
                getAppealInfo:function(){
                    if(!this.orderId){
                        return JuaBox.info('error order id.')
                    }
                    if(this.locked){
                        return;
                    }
                    this.locked = true;
                    Methods.ajax({
                        type: 'POST',
                        data : {
                            orderId : this.orderId,
                            pageSize: this.pageSize,
                            page:this.pageIndex
                        },
                        url: DOMAIN_MAIN + API_PREFIX + 'getAppealInfo',
                        success: function(res) {
                            this.locked = false;
                            this.appealInfo = res.datas;
                        }.bind(this),
                        error:function(){
                            this.locked = false;
                            JuaBox.showWrong(EXX.L(res.resMsg.message));
                        }.bind(this)
                    });
                },
                setAppealInfo:function(appealInfo){
                    this.loaded = true;
                }
            },
            mounted:function(){
                this.getAppealInfo();
            },
            created: function(){

            },
            watch:{
                appealInfo:function(val){
                    this.setAppealInfo(val)
                }
            }
        });
    })
</script>